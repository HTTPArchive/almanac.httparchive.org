---
#See https://github.com/HTTPArchive/almanac.httparchive.org/wiki/Authors'-Guide#metadata-to-add-at-the-top-of-your-chapters
title: PWA
description: Глава «PWA» Веб-Альманаха 2021 года покрывает сервис-воркеры (применение и возможности), манифесты веб-приложений, инсайты про Lighthouse, библиотеки сервис-воркеров (включая Workbox), нотификации Web Push и их распространение.
authors: [demianrenzulli]
reviewers: [tunetheweb, webmaxru, jeffposnick, andreban, Schweinepriester, hemanth, thepassle, tropicadri]
analysts: [tunetheweb, demianrenzulli]
editors: [rviscomi]
translators: [MeFoDy]
demianrenzulli_bio: Демиан — член консалтинговой команды Google по веб-экосистемам, родился в Буэнос-Айресе (Аргентина), а в настоящее время живёт в Нью-Йорке. Он фокусируется на прогрессивных веб-приложениях и расширенных возможностях. Демиан часто пишет статьи на <a hreflang="en" href="https://web.dev/authors/demianrenzulli/">web.dev</a>.
results: https://docs.google.com/spreadsheets/d/16AkIdDBBkCR5Kgb7kyfYvnNLQBu23Vsh7MUSFHW9RtA
featured_quote: Самые популярные сайты более склонны использовать такие функции, как сервис-воркеры и расширенные возможности.
featured_stat_1: 8,62%
featured_stat_label_1: Процент от 1000 самых популярных сайтов, использующих сервис-воркеры.
featured_stat_2: 57,88%
featured_stat_label_2: Процент PWA, использующих кэш сервис-воркеров.
featured_stat_3: 32,19%
featured_stat_label_3: Процент мобильных сайтов с сервис-воркерами, которые используют библиотеку Workbox.
---

## Введение {introduction}

Шесть лет прошло с того, как [Фрэнсис Берриман](https://twitter.com/phae) и [Алекс Рассел](https://twitter.com/slightlylate) ввели термин <a hreflang="en" href="https://infrequently.org/2015/06/progressive-apps-escaping-tabs-without-losing-our-soul/">«прогрессивное веб-приложение» (Progressive Web App, PWA)</a>, представляющий их видение веб-приложений, которые могут быть такими же захватывающими, как и нативные приложения.
Были перечислены следующие признаки, отличающие их от традиционных веб-сайтов:

- Отзывчивое
- Прогрессивно-улучшенное при помощи сервис-воркеров
- Имеющее взаимодействия, как у приложений
- Свежее
- Безопасное
- Исследуемое
- Вовлекающее повторно
- Линкуемое

В течение последних нескольких лет веб-платформа продолжала развиваться, сокращая разрыв между веб-приложениями и ОС-специфичным опытом и позволяя разработчикам предоставлять пользователям более широкие возможности и новые способы оставаться вовлечёнными.

Несмотря на это, всё ещё сложно провести чёткую грань между PWA и другими приложениями; некоторые эксперты могут придать большее значение созданию «аппового» опыта, характерного для <a hreflang="en" href="https://developers.google.com/web/fundamentals/architecture/app-shell">модели приложения «оболочка и контент»</a>, в то время как другие больше фокусируются на определённых компонентах и поведении, таких как наличие сервис-воркеров и манифеста веб-приложения, обеспечение работы в офлайне или другой расширенной функциональности.

В главе о PWA этого года мы сосредоточимся на всех измеримых аспектах PWA: использовании сервис-воркеров и связанных с ними API, манифестах веб-приложений, а также наиболее популярных библиотеках и инструментах для создания PWA. PWA может использовать все или некоторые из этих функций. Мы рассмотрим уровень внедрения каждого компонента и API, чтобы получить представление об уровне проникновения этих технологий в веб-экосистему.


<p class="note">Примечание: в этой главе основное внимание будет уделено наиболее часто используемым API, связанным с сервис-воркерами. Чтобы узнать о других передовых API, обязательно ознакомьтесь с главой <a href="./capabilities">Возможности</a>.</p>

## Сервис-воркеры {service-workers}

[Сервис-воркеры](https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API) (представлены в декабре 2014 года) — один из основных компонентов PWA. Они действуют как сетевой прокси и позволяют использовать такие функции, как офлайн, push-уведомления и фоновую обработку, характерные для «нативного» опыта.

Потребовалось время, чтобы сервис-воркеры получили широкое распространение, но сегодня они поддерживаются <a hreflang="en" href="https://caniuse.com/serviceworkers">большинством основных браузеров</a>. Однако это не означает, что все функции сервис-воркеров работают в разных браузерах. Например, хоть большинство основных функций (вроде проксирования сети) можно использовать, API вроде `Push` <a hreflang="en" href="https://caniuse.com/push-api">ещё не доступны в WebKit</a>.

### Применение сервис-воркеров {service-workers-usage}

По нашим оценкам, от 1,22% до 3,22% сайтов используют сервис-воркеры в 2021 году, в зависимости от способа измерения. В этом году мы решили принять 3,22% в качестве наиболее точного приближения — по причинам, которые мы объясним позже.

{{ figure_markup(
  caption="Процент мобильных сайтов, использующих сервис-воркеры.",
  content="3,22%",
  classes="big-number",
  chart_url="https://docs.google.com/spreadsheets/d/e/2PACX-1vTHHnqNdpRUjoeTfsN9_irK57PvZn_Q2X842RLl-RL4ibWmZFvO-S1x35PjVE3-xUlHFS_Zurd22rOq/pubchart?oid=1499608158&format=interactive",
  sheets_gid="398503119",
  sql_file="manifests_and_service_workers.sql"
)
}}

Определить, используется ли сервис-воркер, не так просто, как может показаться. Например, Lighthouse определяет 1,5%, однако добавляет <a hreflang="en" href="https://web.dev/service-worker">некоторые дополнительные проверки в это определение</a>, а не просто использование сервис-воркера, так что это значение можно рассматривать как нижнюю границу. <a hreflang="en" href="https://httparchive.org/reports/progressive-web-apps#swControlledPages">Сам Chrome определяет 1,22% сайтов, использующих сервис-воркеры</a>, что на удивление меньше, чем у Lighthouse, по причинам, которые нам не удалось выяснить.

В этом году для главы о PWA мы обновили наши методы измерения, создав <a hreflang="en" href="https://github.com/HTTPArchive/legacy.httparchive.org/blob/master/custom_metrics/pwa.js">новый набор метрик</a>. Например, теперь мы используем эвристику, которая проверяет несколько характеристик сервис-воркера, например, наличие [регистрации сервис-воркера](https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerRegistration) и использование специфичных для сервис-воркеров методов, библиотек и событий.

Из собранных нами данных мы видим, что около 3,05% десктопных сайтов и 3,22% мобильных сайтов используют функции сервис-воркеров, что означает, что использование сервис-воркеров может быть выше, чем было измерено в <a hreflang="en" href="https://almanac.httparchive.org/en/2020/pwa#service-worker-usage">прошлогодней главе (0,88% для десктопов и 0,87% для мобильных устройств)</a>.

Можно подумать, что немногим более 3% сайтов, регистрирующих сервис-воркеры на мобильных и десктопах, — небольшое число, но как это соотносится с веб-трафиком?

<a hreflang="en" href="https://www.chromestatus.com/features">Chrome Platform Status</a> предоставляет статистику использования, полученную из браузера Chrome. Согласно этой статистике, сервис-воркеры управляли <a hreflang="en" href="https://www.chromestatus.com/metrics/feature/timeline/popularity/990">19,26% загрузок страниц в июле 2021 года</a>. По сравнению с <a hreflang="en" href="../2020/pwa#service-worker-usage">прошлогодним показателем в 16,6%</a>, такое число представляет собой ежегодный рост загрузок страниц, управляемых сервис-воркерами, на 12%.

{{ figure_markup(
  caption='Процент визитов страниц, на которых зарегистрирован сервис-воркер. (Источник: <a hreflang="en" href="https://www.chromestatus.com/metrics/feature/timeline/popularity/990">Chrome Platform Status</a>)',
  content="19,26%",
  classes="big-number"
)
}}

И как мы можем объяснить, что примерно 3% сайтов составляют около 19% веб-трафика? Интуитивно можно подумать, что у веб-сайтов с высокой посещаемостью больше причин использовать сервис-воркеры. Наличие более широкой пользовательской базы означает, что пользователи могут приходить на сайт с различных устройств и с разным типом подключения, поэтому появляется больше стимулов для внедрения API, обеспечивающих преимущества в производительности и надёжности. Кроме того, у этих компаний часто есть нативные приложения, поэтому есть больше причин для преодоления разрыва в UX между платформами через реализацию расширенных возможностей сервис-воркерами. Следующие данные помогают нам подтвердить это предположение:

{{ figure_markup(
  image="pwa-service-worker-controlled-pages-by-rank.png",
  caption="Страницы, управляемые сервис-воркерами, по рангу.",
  description="Гистограмма показывает отранжированные страницы, управляемые сервис-воркерами. Для десктопа 8,55% из топ-1 000 страниц, 7,75% из топ-10 000 страниц, 4,32% из топ-100 000 страниц, 2,07% из топ-1 000 000 страниц и 1,22% от всех страниц управляются сервис-воркерами. Для мобильных — 8,62% из топ-1 000, 8.05% из топ-10 000, 4.61% из топ-100 000, 2.17% из топ-1 000 000 и 1.19% от всех страниц.", chart_url="https://docs.google.com/spreadsheets/d/e/2PACX-1vTHHnqNdpRUjoeTfsN9_irK57PvZn_Q2X842RLl-RL4ibWmZFvO-S1x35PjVE3-xUlHFS_Zurd22rOq/pubchart?oid=719919882&format=interactive",
  sheets_gid="1703190302",
  sql_file="sw_adoption_over_time_ranking.sql"
  )
}}

При измерении топ-1 000 сайтов мы видим, что 8,62% из них применяют сервис-воркеры. По мере увеличения количества анализируемых сайтов общий процент начинает уменьшаться. Это указывает на то, что наиболее популярные сайты более склонны использовать такие функции, как сервис-воркеры и расширенные возможности.

### Функции сервис-воркеров {service-worker-features}

В этой секции мы проанализируем распространение различных функций сервис-воркеров ([событий](https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerGlobalScope#events), [свойств](https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerGlobalScope#properties), [методов](https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerGlobalScope#methods)) для наиболее общих задач PWA (офлайн, push-уведомления, фоновая обработка и т.д.).

#### События сервис-воркеров {service-worker-events}

Интерфейс [ServiceWorkerGlobalScope](https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerGlobalScope) представляет собой глобальный контекст исполнения сервис-воркера и управляется различными [событиями](https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerGlobalScope#events). Их можно слушать двумя способами: через обработчики событий или через свойства сервис-воркера.

Например, вот два способа подписки на событие `install` в сервис-воркере:

```javascript
// Через обработчик событий:
this.addEventListener('install', function(event) {
  // …
});

// Через свойство:
this.oninstall = function(event) {
  // …
};
```

Мы измерили и объединили оба способа реализации обработчиков событий и получили следующую статистику:

{{ figure_markup(
  image="pwa-most-used-service-worker-events.png",
  caption="Наиболее используемые события сервис-воркеров.",
  description="Гистограмма показывает наиболее используемые события сервис-воркеров, отсортированные по проценту применения. Для десктопов `install` применяется на 70,73% PWA-страниц, `activate` — на 64,85%, `notificationclick` — на 45,62%, `push` — на 43,88%, `notificationclose` — на 5,98%, `sync` — на 3,75% и `periodicsync` — на 0,04%. Для мобильных `install` применяется на 70,40% PWA-странице, `activate` — на 63,00%, `notificationclick` — на 46,62%, `push` — на 45,44%, `notificationclose` — на 6,34%, `sync` — на 3,72% и `periodicsync` — на 0,04%.", chart_url="https://docs.google.com/spreadsheets/d/e/2PACX-1vTHHnqNdpRUjoeTfsN9_irK57PvZn_Q2X842RLl-RL4ibWmZFvO-S1x35PjVE3-xUlHFS_Zurd22rOq/pubchart?oid=1443205721&format=interactive",
  sheets_gid="1329278694",
  sql_file="sw_events.sql"
  )
}}

Мы можем разделить эти результаты на 3 подкатегории:

- События жизненного цикла
- События, связанные с уведомлениями
- События фоновой обработки

##### События жизненного цикла {lifecycle-events}

Первые два обработчика событий на графике принадлежат <a hreflang="en" href="https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle">событиям жизненного цикла</a>. Реализация этих обработчиков событий позволяет при необходимости выполнять дополнительные задачи при запуске этих событий. `install` срабатывает, как только воркер начинает выполняться, и он вызывается только один раз для каждого сервис-воркера, что позволяет вам кэшировать всё, что вам нужно, прежде чем сервис-воркер возьмет на себя управление. `activate` срабатывает, когда новый сервис-воркер может управлять клиентами, а старый сервис-воркер выключается. Это хорошее время для таких вещей, как очистка старых кэшей, которые использовались предыдущим сервис-воркером, но которые больше не нужны.

Оба обработчика событий получили широкое распространение: 70,40% мобильных и 70,73% десктопных PWA реализуют обработчик события `install`, а 63,00% мобильных и 64,85% десктопов подписаны на `activate`. Это ожидаемо, поскольку задачи, которые могут выполняться внутри этих событий, имеют решающее значение для производительности и надёжности (например, <a hreflang="en" href="https://developers.google.com/web/tools/workbox/modules/workbox-precaching">предварительное кэширование</a>).
Причины отказа от обработчиков событий жизненного цикла включают: использование сервис-воркеров только для уведомлений (без какой-либо стратегии кэширования) или применение методов кэширования только к запросам, сделанным сайтом во время его работы — метод, называемый <a hreflang="en" href="https://web.dev/runtime-caching-with-workbox/">рантайм-кэширование</a>, которое часто (но не исключительно) используется в сочетании с методами предварительного кэширования.

##### События, связанные с уведомлениями {notification-related-events}

Как показано на [Графике 16.4](#fig-4), следующая по популярности группа обработчиков событий — это `push`,`notificationclick` и `notificationclose`, которые связаны с <a hreflang="en" href="https://developers.google.com/web/fundamentals/push-notifications">Web Push Notifications</a>.
Наиболее распространенным является `push`, который позволяет вам прослушивать push-события, отправляемые сервером — его используют 43,88% десктопных и 45,44% мобильных сайтов с сервис-воркерами. Это демонстрирует, насколько популярны веб-push-уведомления в PWA, даже если они <a hreflang="en" href="https://caniuse.com/push-api">ещё не доступны во всех браузерах</a>.

##### События фоновой обработки {background-processing-events}

Последняя группа событий на [Графике 16.4](#fig-4) позволяет вам запускать определенные задачи в сервис-воркерах в фоновом режиме, например, для синхронизации данных или повторения задач при сбое подключения. <a hreflang="en" href="https://developers.google.com/web/updates/2015/12/background-sync">Фоновая синхронизация</a> (через обработчик события `sync`) позволяет веб-приложению делегировать задачу сервис-воркеру и автоматически повторить её в случае сбоя или отсутствия подключения (в этом случае сервис-воркер ожидает восстановления подключения, чтобы автоматически повторить попытку). <a hreflang="en" href="https://web.dev/periodic-background-sync/">Периодическая фоновая синхронизация</a> (через `periodSync`) позволяет запускать задачи в сервис-воркере через определенные промежутки времени (например, для получения и кэширования главных новостей каждое утро). Другие API, такие как <a hreflang="en" href="https://developers.google.com/web/updates/2018/12/background-fetch">Background Fetch</a>, не отображаются на графике, так как их использование всё ещё довольно малое.

Как видно, методы фоновой синхронизации пока не получили широкого распространения по сравнению с другими. Отчасти это связано с тем, что случаев для применения фоновой синхронизации меньше, а API пока доступны не во всех браузерах. [Периодическая фоновая синхронизация](https://developer.mozilla.org/en-US/docs/Web/API/Web_Periodic_Background_Synchronization_API) для её использования также требует, чтобы PWA был установлен, что делает её недоступной для сайтов, у которых нет функциональности [«добавить на домашний экран»](https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps/Add_to_home_screen).

Несмотря на это, есть несколько важных причин для применения фоновой синхронизации в современных веб-приложениях: одна из них — офлайн-аналитика (<a hreflang="en" href="https://developers.google.com/web/tools/workbox/modules/workbox-google-analytics">Workbox Analytics использует для этого фоновую синхронизацию</a>), вторая — повтор неудачных запросов из-за отсутствия подключения (как <a hreflang="en" href="https://web.dev/google-search-sw/">делают некоторые поисковики</a>).

<p class="note">Примечание: в отличие от предыдущих лет, мы решили не включать в этот анализ события <code>fetch</code> и <code>message</code>, поскольку они также могут появляться вне сервис-воркеров, что может привести к высокому количеству ложных срабатываний. Поэтому приведённый выше анализ относится к событиям, специфичным для сервис-воркеров. <a hreflang="en" href="../2020/pwa#service-worker-events">Согласно данным за 2020 год, <code>fetch</code> использовался почти столько же, сколько <code>install</code>.</a></p>

#### Другие популярные функции сервис-воркеров {other-popular-service-worker-features}

Помимо обработчиков событий, есть и другие важные функции сервис-воркеров, которые интересно отметить, учитывая их полезность и популярность.

Следующие два ивента довольно популярны и часто используются в тандеме:

- `ServiceWorkerGlobalScope.skipWaiting()`
- `Clients.claim()`

[`ServiceWorkerGlobalScope.skipWaiting()`](https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerGlobalScope/skipWaiting) обычно вызывается в начале события `install` и позволяет заново установленному сервис-воркеру немедленно перейти в состояние `active`, даже если есть другой активный сервис-воркер. Наш анализ показал, что он используется в 60,47% десктопных и 59,60% мобильных PWA.

{{ figure_markup(
  caption="Процент мобильных сайтов с сервис-воркерами, которые вызывают `skipWaiting()`",
  content="59,60%",
  classes="big-number",
  chart_url="https://docs.google.com/spreadsheets/d/e/2PACX-1vTHHnqNdpRUjoeTfsN9_irK57PvZn_Q2X842RLl-RL4ibWmZFvO-S1x35PjVE3-xUlHFS_Zurd22rOq/pubchart?oid=2101442063&format=interactive",
  sheets_gid="1589747311",
  sql_file="sw_methods.sql"
)
}}

[`Clients.claim()`](https://developer.mozilla.org/en-US/docs/Web/API/Clients/claim) часто используется в сочетании со `skipWaiting()`, что позволяет активным сервис-воркерам «требовать контроль» над всеми клиентами, находящимися в его скоупе. Встречается на 48,98% десктопных страниц и 47,14% мобильных.

{{ figure_markup(
  caption="Процент мобильных сайтов с сервис-воркерами, которые вызывают `clients.claim()`",
  content="47,14%",
  classes="big-number",
  chart_url="https://docs.google.com/spreadsheets/d/e/2PACX-1vTHHnqNdpRUjoeTfsN9_irK57PvZn_Q2X842RLl-RL4ibWmZFvO-S1x35PjVE3-xUlHFS_Zurd22rOq/pubchart?oid=2101442063&format=interactive",
  sheets_gid="1786812377",
  sql_file="sw_objects.sql"
)
}}

Комбинирование обоих предыдущих ивентов означает, что новый сервис-воркер немедленно вступит в силу, заменив предыдущий, без необходимости ждать, пока активные клиенты (например, вкладки) будут закрыты и снова будут открыты позже (например, новая пользовательская сессия), что является поведением по умолчанию.
Разработчики считают эту технику полезной для обеспечения немедленного выполнения каждого критического обновления, что объясняет его широкое распространение.

Ещё один интересный аспект для анализа — операции кэширования, которые часто используются в сервис-воркерах и лежат в основе работы PWA, поскольку они включают такие функции, как офлайн, и помогают повысить производительность.
Свойство [`ServiceWorkerGlobalScope.caches`](https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerGlobalScope/caches) возвращает объект [CacheStorage](https://developer.mozilla.org/en-US/docs/Web/API/CacheStorage), связанный с сервис-воркером, дающий доступ к различным [кэшам](https://developer.mozilla.org/en-US/docs/Web/API/Cache). Мы обнаружили, что оно используется на 57,41% десктопных и 57,88% мобильных сайтов, использующих сервис-воркеры.

{{ figure_markup(
  caption="Процент мобильных сайтов с сервис-воркерами, использующих кэш сервис-воркера",
  content="57,88%",
  classes="big-number",
  chart_url="https://docs.google.com/spreadsheets/d/e/2PACX-1vTHHnqNdpRUjoeTfsN9_irK57PvZn_Q2X842RLl-RL4ibWmZFvO-S1x35PjVE3-xUlHFS_Zurd22rOq/pubchart?oid=107056879&format=interactive",
  sheets_gid="1879897527",
  sql_file="sw_objects_name_only.sql"
)
}}

Его частое использование не является неожиданным, поскольку кэширование позволяет создавать надёжные и производительные веб-приложения, что часто является одной из основных причин, по которым разработчики работают над PWA.

Наконец, стоит взглянуть на <a hreflang="en" href="https://developers.google.com/web/updates/2017/02/navigation-preload">предзагрузки навигации</a>, которые позволяют вам делать запросы параллельно со временем загрузки сервис-воркера, чтобы избежать задержки запросов в таких ситуациях. Интерфейс [`NavigationPreloadManager`](https://developer.mozilla.org/en-US/docs/Web/API/NavigationPreloadManager) предоставляет набор методов для реализации этой техники, и, согласно нашему анализу, он в настоящее время используется на 11,02% десктопных и 9,78% мобильных сайтов, на которых используются сервис-воркеры.

{{ figure_markup(
  caption="Процент мобильных сайтов, которые используют предзагрузку навигации",
  content="9,78%",
  classes="big-number",
  chart_url="https://docs.google.com/spreadsheets/d/e/2PACX-1vTHHnqNdpRUjoeTfsN9_irK57PvZn_Q2X842RLl-RL4ibWmZFvO-S1x35PjVE3-xUlHFS_Zurd22rOq/pubchart?oid=1163792530&format=interactive",
  sheets_gid="504745822",
  sql_file="sw_registration_properties_name_only.sql"
)
}}

Предзагрузка навигации считается достаточно популярной, несмотря на то, что она <a hreflang="en" href="https://caniuse.com/?search=navigation%20preload%20manager">пока доступна не во всех браузерах</a>. От применения этой техники могут выиграть многие разработчики, и они могут реализовать её как [прогрессивное улучшение](https://developer.mozilla.org/en-US/docs/Glossary/Progressive_Enhancement).

## Манифесты веб-приложений {web-app-manifests}

[Манифест веб-приложения](https://developer.mozilla.org/en-US/docs/Web/Manifest) — это файл JSON, который содержит метаданные о веб-приложении и является одним из основных компонентов PWA, поскольку публикация манифеста веб-приложения является одним из предварительных условий для предоставления функции «добавить на домашний экран», которая позволяет пользователям устанавливать веб-приложение на свои устройства. Другие условия включают работу сайта через HTTPS, наличие иконки и в некоторых браузерах (например, Chrome и Edge) наличие сервис-воркера.
Учтите, что <a hreflang="en" href="https://web.dev/installable-manifest/#in-other-browsers">разные браузеры имеют разные критерии для установки</a>.

Вот некоторая статистика использования манифестов веб-приложений. Их полезно визуализировать рядом с сервис-воркерами, чтобы получить представление о потенциальном проценте «устанавливаемых» веб-приложений:

{{ figure_markup(
  image="pwa-service-worker-and-manifest-usage.png",
  caption="Использование сервис-воркеров и манифестов",
  description="Гистограмма показывает использование сервис-воркеров и манифестов на десктопных и мобильных сайтах. Сервис-воркеры применяются на 3,05% десктопных страниц и на 3,22% мобильных страниц, манифесты — на 7,43% и 7,26% соответственно, какой-нибудь из них — на 8,91% и 8,76%, оба — на 1,57% и 1,71%.", chart_url="https://docs.google.com/spreadsheets/d/e/2PACX-1vTHHnqNdpRUjoeTfsN9_irK57PvZn_Q2X842RLl-RL4ibWmZFvO-S1x35PjVE3-xUlHFS_Zurd22rOq/pubchart?oid=1499608158&format=interactive",
  sheets_gid="398503119",
  sql_file="manifests_and_service_workers.sql"
  )
}}

Манифесты используются на страницах более чем в два раза чаще, чем сервис-воркеры. Одна из причин заключается в том, что некоторые платформы (например, [CMS](./cms)) автоматически создают файлы манифеста для сайтов, даже для тех, у которых нет сервис-воркеров.

С другой стороны, сервис-воркеры могут использоваться без манифеста. Например, некоторые разработчики могут захотеть добавить на свои сайты push-уведомления, кэширование или работу в офлайне, но могут не быть заинтересованы в возможности установки и, следовательно, не создавать манифест.

На графике выше мы видим, что 1,57% десктопных сайтов и 1,71% мобильных сайтов имеют как сервис-воркер, так и манифест. Это первое приближение к потенциальному проценту «устанавливаемых» веб-сайтов.

Помимо манифеста веб-приложения и сервис-воркера, содержимое манифеста также должно соответствовать некоторым дополнительным <a hreflang="en" href="https://web.dev/installable-manifest/">критериям устанавливаемости</a> для установки веб-приложения. Далее мы проанализируем каждое из его свойств.

### Свойства манифеста {manifest-properties}

На следующей диаграмме показано использование <a hreflang="en" href="https://w3c.github.io/manifest/#web-application-manifest">стандартных свойств манифеста</a> для группы сайтов, у которых также есть сервис-воркер.

{{ figure_markup(
  image="pwa-top-pwa-manifest-properties.png",
  caption="Топ свойств манифеста PWA.",
  description="Гистограмма показывает топ свойств манифеста PWA для десктопов и мобильных. `name` используется в 94,78% манифестов десктопных PWA и 94,61% мобильных, `icons` — в 92,22% и 92,18% соответственно, `display` — в 72,77% и 74,27%, `theme_color` — в 70,64% и 71,64%, `background_color` — в 67,87% и 69,53%, `short_name` — в 64,57% и 63,64%, `start_url` — в 37,27% и 42,35%, `description` — в 11,86% и 12,59%, `scope` — в 10,20% и 11,66%, и, наконец, `orientation` — в 8,71% и 12,16%.", chart_url="https://docs.google.com/spreadsheets/d/e/2PACX-1vTHHnqNdpRUjoeTfsN9_irK57PvZn_Q2X842RLl-RL4ibWmZFvO-S1x35PjVE3-xUlHFS_Zurd22rOq/pubchart?oid=105221079&format=interactive",
  sheets_gid="137691358",
  sql_file="top_manifest_properties.sql"
  )
}}

Эта диаграмма интересна в сочетании с <a hreflang="en" href="https://web.dev/installable-manifest/">критериями устанавливаемых манифестов Lighthouse</a>. <a hreflang="en" href="https://developers.google.com/web/tools/lighthouse">Lighthouse</a> — популярный инструмент для анализа качества веб-сайтов и, как мы увидим в <a href="#lighthouse-insights">разделе инсайтов из Lighthouse</a>, 61,73% PWA-сайтов имеют устанавливаемый манифест, основанный на этих критериях.

Далее мы проанализируем каждое из требований к установке от Lighthouse, одно за другим, в соответствии с предыдущим графиком:

- `name` или `short_name`: свойство `name` присутствует на 90% сайтов, в то время как `short_name` появляется на 83,08% и 84,69% сайтов для десктопных и мобильных устройств соответственно. Частое использование этих свойств имеет смысл, поскольку оба являются ключевыми атрибутами: на домашнем экране пользователя отображается `name`, но если оно слишком длинное или пространства на экране слишком мало, вместо него может отображаться `short_name`.
- `icon`: это свойство появляется на 84,69% десктопных и 86,11% мобильных сайтов. Иконки используются в различных местах: на домашнем экране, в переключателе задач операционной системы и т.д. Это объясняет его широкое распространение.
- `start_url`: это свойство присутствует на 82,84% десктопных и 84,66% мобильных сайтов. Это ещё одно важное свойство для PWA, поскольку оно указывает, какой URL будет открыт, когда пользователь запускает веб-приложение.
- `display`: это свойство объявлено на 86,49% десктопных и 87,67% мобильных сайтов. Оно используется для обозначения режима отображения веб-сайта. Если оно не указано, значением по умолчанию является `browser`, который является обычной вкладкой браузера, поэтому большинство PWA объявляют его, чтобы указать, что вместо этого сайт должен быть открыт в режиме `standalone`. Возможность открываться в автономном режиме — одна из вещей, которая помогает создать «нативное» впечатление.
- `prefer_related_applications`: это свойство присутствует на 6,87% сайтов для десктопов и 7,66% сайтов для мобильных устройств, что кажется низким процентом по сравнению с остальными свойствами в этом списке. Причина в том, что Lighthouse не требует, чтобы оно присутствовало, он только предлагает не устанавливать для него значение `true`.

Далее мы углубимся в свойства, которые позволяют нам определять набор значений. Чтобы понять, какие из них наиболее широко используются.

### Самые популярные размеры иконок в манифестах {top-manifest-icon-sizes}

{{ figure_markup(
  image="pwa-top-pwa-manifest-icon-sizes.png",
  caption="Самые популярные размеры иконок в манифестах.",
  description="Гистограмма показывает самые популярные размеры иконок в манифестах для десктопов и мобильных. `192x192` применяется на 72,58% десктопных PWA-сайтов и 74,20% мобильных, `512x512` — на 70,09% и 70,36% соответственно,`144x144` — на 32,76% и 32,59%, `96x96` — на 23,73% и 23,39%, `48x48` — на 23,10% и 22,50%, `72x72` — на 21,03% и 21,30%, `128x128` — на 16,19% и 16,30%, `152x152` — на 14,11% и 14,52%, `384x384` — на 12,93% и 11,84%, `256x256` — на 11,73% и 11,86%, `16x16` — на 8,10% и 8,32%, `36x36` — на 7,36% и 7,01%, `64x64` — на 6,18% и 6,38%, `32x32` — на 6,05% и 6,37%, и, наконец, `120x120` — на 6,14% and 5,61%.", chart_url="https://docs.google.com/spreadsheets/d/e/2PACX-1vTHHnqNdpRUjoeTfsN9_irK57PvZn_Q2X842RLl-RL4ibWmZFvO-S1x35PjVE3-xUlHFS_Zurd22rOq/pubchart?oid=1930133957&format=interactive",
  sheets_gid="1450624146",
  sql_file="top_manifest_icon_sizes.sql"
  )
}}

Самыми популярными размерами иконок на сегодняшний день являются 192x192 и 512x512, которые <a hreflang="en" href="https://web.dev/add-manifest/#icons">рекомендуются в Lighthouse</a>. На практике разработчики также предоставляют другие размеры, чтобы они хорошо смотрелись на различных экранах устройств.

### Самые популярные значения свойства display {top-manifest-display-values}

{{ figure_markup(
  image="pwa-manifest-display-values.png",
  caption="Самые популярные значения свойства display.",
  description="Гистограмма показывает самые популярные значения свойства display на десктопных и мобильных. `standalone` применяется на 74,83% десктопных PWA-страниц и 79,02% мобильных, (не задано) — на 13,51% и 12,33% соответственно, `minimal-ui` — на 6,89% и 4,10%, `fullscreen` — на 3,74% и 3,64%, и ,наконец, `browser` — на 0,92% и 0,82%.", chart_url="https://docs.google.com/spreadsheets/d/e/2PACX-1vTHHnqNdpRUjoeTfsN9_irK57PvZn_Q2X842RLl-RL4ibWmZFvO-S1x35PjVE3-xUlHFS_Zurd22rOq/pubchart?oid=270665105&format=interactive",
  sheets_gid="403639702",
  sql_file="top_manifest_display_values.sql"
  )
}}

Свойство display определяет предпочитаемый разработчиком режим для веб-сайта.
В режиме `standalone` установленные PWA открываются без каких-либо элементов пользовательского интерфейса браузера, что делает их «похожими на приложение». Диаграмма показывает, что большинство сайтов с сервис-воркером и манифестом используют это значение: 74,83% на десктопах и 79,02% на мобильных.

### Предпочтение нативным приложениям {manifests-preferring-native}

Наконец, мы проанализируем `prefer_related_applications`. Если для этого свойства установлено значение `true`, браузер может предложить установить одно из связанных приложений вместо веб-приложения.

{{ figure_markup(
  image="pwa-manifests-preferring-native-app.png",
  caption="Манифесты, отдающие предпочтения нативным приложениям.",
  description="Гистограмма показывает PWA-манифесты, отдающие предпочтения нативным приложениям, с 97,92% десктопных PWA-страниц и 98,03% мобильных PWA-страниц с этим свойством со значением `false`, и только 1,86% десктопных страниц и 1,79% мобильных страниц с этим свойством в значении `true`.", chart_url="https://docs.google.com/spreadsheets/d/e/2PACX-1vTHHnqNdpRUjoeTfsN9_irK57PvZn_Q2X842RLl-RL4ibWmZFvO-S1x35PjVE3-xUlHFS_Zurd22rOq/pubchart?oid=1882009659&format=interactive",
  sheets_gid="1552027039",
  sql_file="manifests_preferring_native_apps.sql"
  )
}}

`prefer_related_applications` появляется только на 6,87% десктопных и 7,66% мобильных сайтов. На диаграмме показано, что 97,92% десктопных сайтов и 93,03% мобильных сайтов, для которых определено это свойство, имеют значение `false`. Это указывает на то, что большинство разработчиков PWA предпочитают предлагать возможности PWA, а не нативное приложение.

Несмотря на то, что подавляющее большинство разработчиков PWA предпочитают продвигать свой PWA вместо нативных приложений, некоторые известные PWA (например, Twitter) по-прежнему предпочитают рекомендовать нативное приложение, а не PWA. Это может быть связано с предпочтениями команд, создающих эти приложения, или с некоторыми конкретными бизнес-потребностями (отсутствие некоторых API в вебе).

<p class="note">Примечание: вместо того, чтобы принимать это решение статически во время настройки, разработчики также могут <a hreflang="en" href="https://web.dev/define-install-strategy/">создавать более динамические эвристики</a> для продвижения приложения, например, основанные на поведении пользователя или других характеристиках (устройство, соединение, местоположение и т.д.).</p>

### Самые популярные категории манифеста {top-manifest-categories}

В прошлогоднюю главу, посвященную PWA, мы включили раздел о <a hreflang="en" href="../2020/pwa#top-manifest-categories">категориях в манифестах</a>, показывающий процентное соотношение PWA по отрасли, основанный на свойстве манифеста [categories](https://developer.mozilla.org/en-US/docs/Web/Manifest/categories).

В этом году мы решили не полагаться на это свойство, чтобы определить, сколько существует PWA каждой категории, поскольку использование этого свойства невероятно низкое (менее 1% сайтов имеют это свойство).

Ввиду отсутствия данных по категориям и отраслям, использующим PWA, мы обращаемся за этой информацией к внешним источникам. Компания Mobsted недавно опубликовала собственный <a hreflang="en" href="https://mobsted.com/world_state_of_pwa_2021">анализ использования PWA</a>, в котором, среди прочего, анализировался процент PWA по отраслям:

{{ figure_markup(
  image="pwa-industry-categories.png",
  caption='Отраслевые категории PWA (Источник: <a hreflang="en" href="https://mobsted.com/world_state_of_pwa_2021">отчёт компании Mobsted «PWA 2021»</a>).',
  description="Гистограмма показывает отраслевые категории PWA с большим разнообразием применения среди индустрий. Индустрия Взрослого контента использует 0,3% PWA, Искусство и Развлечения — 10,0%, Авто и Транспорт — 2,8%, Красота и Фитнес — 5,0%, Книги и Литература — 0,9%, Бизнес и Промышленность — 14,4%, Компьютеры и Электроника — 2,1%, Финансы — 3,2%, Еда и Напитки — 5,6%, Игры — 1,2%, Здоровье — 5,7%, Хобби и Отдых — 5,6%, Дом и Сад — 8,8%, Интернет и Телеком — 1,5%, Работа и Образование — 3,1%, Закон и Правительство — 3,3%, Новости — 1,1%, Онлайн-сообщества — 0,8%, Люди и Общество — 6,1%, Животные — 0,4%, Недвижимость — 4,3%, Ссылки — 0,8%, Наука — 1,5%, Чувствительные темы — 0,9%, Покупки — 5,1%, Спорт — 2,3%, и, наконец, Путешествия — 3,3%", chart_url="https://docs.google.com/spreadsheets/d/e/2PACX-1vTHHnqNdpRUjoeTfsN9_irK57PvZn_Q2X842RLl-RL4ibWmZFvO-S1x35PjVE3-xUlHFS_Zurd22rOq/pubchart?oid=891344722&format=interactive",
  sheets_gid="1817367668",
  width=590,
  height=600
  )
}}

Согласно анализу компании Mobsted, наиболее распространенными категориями являются «Бизнес и Промышленность», «Искусство и Развлечения» и «Дом и Сад». Это, похоже, коррелирует с [прошлогодним анализом свойства веб-манифеста category](../2020/pwa#top-manifest-categories), где тремя самыми популярными значениями были «покупки», «бизнес» и «развлечения».

## Инсайты из Lighthouse {lighthouse-insights}

В разделе <a href="#manifest-properties">про свойства манифеста</a> мы упомянули <a hreflang="en" href="https://web.dev/installable-manifest/">требования к устанавливаемости</a>, которые Lighthouse имеет к файлам манифеста веб-приложения. Lighthouse также предоставляет проверки для других аспектов, которые определяют PWA. Следует отметить, что HTTP Archive в настоящее время прогоняет тесты Lighthouse только во время своего мобильного краулинга, как указано в нашей <a hreflang="en" href="../methodology">методологии</a>.

На следующей диаграмме показан процент сайтов, соответствующих каждому критерию, где пункт «PWA sites» содержит статистику для сайтов, у которых есть сервис-воркер и манифест, пункт «All sites» содержит данные для всех сайтов в целом:

{{ figure_markup(
  image="pwa-lighthouse-pwa-audits.png",
  caption="Аудиты PWA в Lighthouse.",
  description="Гистограмма показывает аудиты PWA в Lighthouse для всех сайтов и PWA-сайтов. В то время, как некоторые проверки широко используются для обоих категорий, многие из них широко используются только PWA-сайтами, и PWA-сайты с комфортом опережают все веб-сайты во всех категориях. Аудит `viewport` проходят 91,16% всех сайтов и 99,42% PWA-сайтов, `redirects-http` — 78,01% и 98,23% соответственно, `content-width` — 81,86% и 94,70%, `service-worker` — 1,50% и 84,86%, `apple-touch-icon` — 39,25% и 77,78%, `themed-omnibox` — 4,64% и 68,78%, `splash-screen` — 2,28% и 63,40%, `installable-manifest` — 1,08% и 61,73%, `maskable-icon` — 0,38% и 17,46%.", chart_url="https://docs.google.com/spreadsheets/d/e/2PACX-1vTHHnqNdpRUjoeTfsN9_irK57PvZn_Q2X842RLl-RL4ibWmZFvO-S1x35PjVE3-xUlHFS_Zurd22rOq/pubchart?oid=991530366&format=interactive",
  sheets_gid="1312576011",
  sql_file="lighthouse_pwa_audits.sql"
  )
}}

Как и ожидалось, таблица показывает, что группа сайтов, которые мы определили как PWA (те, у которых есть сервис-воркер и манифест), как правило, проходит каждый PWA-аудит в Lighthouse. Хотя некоторые аудиты, не относящиеся к PWA (например, настройка вьюпорта или редирект с HTTP на HTTPS), получают высокие оценки на всех сайтах, существует явная разница для аудитов, специфичных для PWA, которые на самом деле используются только PWA-сайтами.

Интересно отметить, что <a hreflang="en" href="https://web.dev/maskable-icon/">маскируемые иконки</a> имеют низкий рейтинг прохождения даже для PWA-сайтов по сравнению с остальными PWA-аудитами. Использование маскируемых иконок позволяет улучшить внешний вид иконок на устройствах Android, заставляя их заполнять всю доступную им форму (как отзывчивость для иконок). Эта функция не является обязательной и в основном интересна для PWA, которые предлагают возможность установки. В отличие от других функций PWA (вроде офлайна), сайтам, не являющимся PWA, такое редко будет интересно.

Lighthouse также предоставляет <a hreflang="en" href="https://web.dev/lighthouse-pwa/">оценку PWA</a>, основанную на «успешности» всех этих аудитов. На следующей диаграмме сравниваются полученные баллы в двух группах, проанализированных ранее:

{{ figure_markup(
  image="pwa-lighthouse-pwa-scores.png",
  caption="Оценки PWA в Lighthouse.",
  description="Гистограмма показывает оценки PWA в Lighthouse для всех веб-сайтов и PWA-сайтов как перцентиль, с оценками PWA-сайтов приблизительно в два раза лучше, чем на всех сайтах, по всем перцентилям. 10-й перцентиль имеет оценку 25 для всех сайтов и 50 для PWA-сайтов, 25-й — 33 и 58 соответственно, 50-й — 42 и 83, 75-й — 50 и 92, и, наконец, 90-й перцентиль имеет оценки 50 и 100.", chart_url="https://docs.google.com/spreadsheets/d/e/2PACX-1vTHHnqNdpRUjoeTfsN9_irK57PvZn_Q2X842RLl-RL4ibWmZFvO-S1x35PjVE3-xUlHFS_Zurd22rOq/pubchart?oid=2065040053&format=interactive",
  sheets_gid="1466930372",
  sql_file="lighthouse_pwa_score.sql"
  )
}}

Вот несколько наблюдений:

- Медианная оценка для «PWA-сайтов» составляет 83, по сравнению с 42 для «Всех сайтов».
- В верхней части мы видим, что для «PWA-сайтов» не менее 10% получают максимальную (100) оценку в категории PWA. При просмотре «Всех сайтов» 75-й и 90-й процентили достигают значения не более 50.
- Взглянув на нижнюю часть диаграммы, мы видим, что 90% «PWA-сайтов» имеют оценку PWA в Lighthouse не менее 50 по сравнению с 25 для «Всех сайтов».

Опять же, разница между обеими группами является ожидаемой, поскольку «PWA-сайты», естественно, склонны проходить специфические для PWA требования чаще, чем «Все сайты». В любом случае средний балл 83 для PWA-сайтов предполагает, что значительная часть PWA-разработчиков придерживается лучших практик.

## Service worker libraries

Service workers can use libraries to take care of common tasks, functionalities and best practices (e.g., to implement caching techniques, push notifications, etc.). The most common way of doing this is by using [importScripts()](https://developer.mozilla.org/en-US/docs/Web/API/WorkerGlobalScope/importScripts), which is the way of importing JavaScript libraries in workers. In other cases, build tools can also inject the code of libraries directly into service workers at build time.

Take into account that not all libraries can be used in worker contexts. Workers don't have access to the [Window](https://developer.mozilla.org/en-US/docs/Web/API/Window), and therefore, the [Document](https://developer.mozilla.org/en-US/docs/Web/API/Document) object,  and have limited access to browser APIs. For that reason, service worker libraries are specifically designed to be used in these contexts.

In this section we'll analyze the popularity of various service worker libraries.

### Popular import scripts

The following chart shows the percentage of usage for the various libraries imported via `importScripts()`.

{{ figure_markup(
  image="pwa-libraries-and-scripts.png",
  caption="Popular PWA libraries and scripts.",
  description="Bar chart showing popular PWA libraries and scripts by desktop and mobile with `workbox` dominatine at 15.43% of desktop and 16.58% of mobile, `recaptcha` at 5.19% and 5.70% respectively, `firebase` at 2.45% and 2.63%, `OneSignalSDK` at 2.53% and 2.51%, `sendpulse` at 1.83% and 1.68%, `pushprofit` at 1.42% and 1.65%, `quora` at 1.28% and 1.07%, and finally `sw_toolbox` by 0.51% on desktop and 0.36% on mobile.", chart_url="https://docs.google.com/spreadsheets/d/e/2PACX-1vTHHnqNdpRUjoeTfsN9_irK57PvZn_Q2X842RLl-RL4ibWmZFvO-S1x35PjVE3-xUlHFS_Zurd22rOq/pubchart?oid=1758350320&format=interactive",
  sheets_gid="645109672",
  sql_file="popular_pwa_libraries.sql"
  )
}}

Workbox is still the most popular library, being used by 15.43% of desktop and 16.58% of mobile sites with service workers, although this may be interpreted as a proxy for Workbox adoption in general. The next section takes a more holistic and accurate approach to measuring adoption.

It's also important to note that the Workbox predecessor `sw_toolbox`, which had <a hreflang="en" href="../2020/pwa#popular-import-scripts">13.92% of usage in desktop and 12.84% in mobile last year</a> dropped to 0.51% and 0.36% respectively this year. This is in part due to the fact that `sw_toolbox` was <a hreflang="en" href="https://github.com/GoogleChromeLabs/sw-toolbox/pull/288">deprecated in 2019</a>. It might have taken some time for some popular frameworks and build tools to remove this package, so we are seeing the drop in adoption more clearly this year. Also, our measurement has changed compared to 2020, by adding more sites, which made this metric decrease even more, making it difficult to do a direct year on year comparison.

<p class="note">Note: Take into account that <code><a href="https://developer.mozilla.org/en-US/docs/Web/API/WorkerGlobalScope/importScripts">importScripts()</a></code> is an API of <code><a href="https://developer.mozilla.org/en-US/docs/Web/API/WorkerGlobalScope">WorkerGlobalScope</a></code> that can be used in other types of worker context like <code><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers">Web Workers</a></code>. <a hreflang="en" href="https://www.google.com/recaptcha/about/">reCaptcha</a>, for example, appears as the second most widely used library, as it uses a web worker that contains an <code>importScripts()</code> call to retrieve the reCaptcha JavaScript code. For that reason, we should consider <a hreflang="en" href="https://firebase.google.com/docs/web/setup">Firebase</a> instead as the second most widely used library in service worker contexts.
</p>

### Workbox usage

<a hreflang="en" href="https://developers.google.com/web/tools/workbox">Workbox</a> is a set of libraries that packages a set of common tasks and best practices for building PWAs. According to the previous chart, Workbox is the most popular library in service workers. So, let's take a closer look at how it's used in the wild.

Starting with <a hreflang="en" href="https://github.com/GoogleChrome/workbox/releases/tag/v5.0.0">Workbox 5</a>, the Workbox team has encouraged developers to create custom bundles of the Workbox runtime instead of using `importScripts()` to load <a hreflang="en" href="https://developers.google.com/web/tools/workbox/modules/workbox-sw">`workbox-sw`</a> (the runtime). The Workbox team will continue supporting `workbox-sw`, but the new technique is now the recommended approach. In fact, the defaults for the build tools have switched to prefer that method.

Based on that, we measured sites using any type of Workbox features and found that the number of sites with service workers using it is much higher than noted above: 33.04% of desktop and 32.19% of mobile PWAs.

{{ figure_markup(
  caption="Percentage of mobile sites with service workers that use the Workbox library.",
  content="32.19%",
  classes="big-number",
  sheets_gid="2116306680",
  sql_file="workbox_usage.sql"
 )
}}

### Workbox versions

{{ figure_markup(
  image="pwa-top-workbox-versions.png",
  caption="Top 10 workbox versions.",
  description="Bar chart showing the most popular 10 Workbox versions by desktop and mobile. 3.0.0 is used by 3.45% of desktop PWA sites and 5.42% of mobile, 3.4.1 by 0.54% and 0.49% respectively, 3.5.0 by 0.66% and 0.57%, 3.6.3 by 1.54% and 1.36%, 4.3.1 by 5.09% and 4.63%, 5.1.2 by 0.50% and 0.52%, 5.1.3 by 0.95% and 0.88%, 5.1.4 by 3.21% and 3.04%, 6.0.2 by 0.61% and 0.58%, and finally 6.1.5 by 4.71% and 5.25%.", chart_url="https://docs.google.com/spreadsheets/d/e/2PACX-1vTHHnqNdpRUjoeTfsN9_irK57PvZn_Q2X842RLl-RL4ibWmZFvO-S1x35PjVE3-xUlHFS_Zurd22rOq/pubchart?oid=554211152&format=interactive",
  sheets_gid="988853150",
  sql_file="workbox_versions.sql"
  )
}}

The chart shows that version <a hreflang="en" href="https://github.com/GoogleChrome/workbox/releases/tag/v6.1.5">6.1.15</a> has the highest level of adoption compared to others. That version was released on April 13th, 2021, and was the latest version at the time of our crawl in July 2021.

There were <a hreflang="en" href="https://github.com/GoogleChrome/workbox/releases">more versions</a> released since that time, and based on the behavior observed on the chart, we expect them to become the most widely used shortly after being launched.

There are also older versions that still count with wide adoption. The reason for that is that some popular tools have adopted older Workbox versions in the past and continue providing it, namely:

- Version 4.3.1 usage is mostly driven by <a hreflang="en" href="https://github.com/facebook/create-react-app/blob/v3.4.4/packages/react-scripts/package.json#L82">create-react-app version 3</a>.
- Version 3.0.0 similarly, is included in <a hreflang="en" href="https://github.com/facebook/create-react-app/blob/v2.1.8/packages/react-scripts/package.json#L72">create-react-app version 2</a>.

### Workbox packages

The Workbox library is provided as a <a hreflang="en" href="https://developers.google.com/web/tools/workbox/modules">set of packages or modules</a> that contain specific functionalities. Each package serves a specific need and can be used together or on its own.

The following table shows the usage of Workbox of the most popular packages:

{{ figure_markup(
  image="pwa-top-workbox-packages.png",
  caption="Top workbox packages.",
  description="Bar chart showing popular top Workbox packages by desktop and mobile. `core` is used by 21.96% of desktop Workbox usage and 23.66% of mobile, `routing` by 17.88% and 20.14%, `strategies` by 15.82% and 15.70%, `precaching` by 14.41% and 14.35%, `sw` by 8.38% and 10.29%, `expiration` by 8.30% and 8.93%, `cacheable-response` by 5.87% and 6.64%, `background-sync` by 3.27% and 3.21%, `window` by 3.36% and 3.08%, and finally `google-analytics` by 1.91% and 1.86%.", chart_url="https://docs.google.com/spreadsheets/d/e/2PACX-1vTHHnqNdpRUjoeTfsN9_irK57PvZn_Q2X842RLl-RL4ibWmZFvO-S1x35PjVE3-xUlHFS_Zurd22rOq/pubchart?oid=1408852146&format=interactive",
  sheets_gid="1733966367",
  sql_file="workbox_packages.sql"
  )
}}

The chart above shows that the following packages are the four most widely used:

- <a hreflang="en" href="https://developers.google.com/web/tools/workbox/modules/workbox-core">Workbox Core</a>: This package contains the common code that each Workbox module relies on (for example, the code to interact with the console and throw meaningful errors). That's why it's the most widely used.
- <a hreflang="en" href="https://developers.google.com/web/tools/workbox/modules/workbox-routing">Workbox Routing</a>: This package allows to intercept requests and respond to them in different ways. It's also a very common task inside a service worker, so it's quite popular.
- <a hreflang="en" href="https://developers.google.com/web/tools/workbox/modules/workbox-precaching">Workbox Precaching</a>: This package allows sites to save some files to the cache while the service worker is installing. This set of files usually constitute the "version" of a PWA (similar to the version of a native app).
- <a hreflang="en" href="https://developers.google.com/web/tools/workbox/modules/workbox-strategies">Workbox Strategies</a>: Unlike preaching, which takes place at the service worker "install" event, this package enables runtime caching strategies to determine how a service worker generates a response after receiving a `fetch` event.

### Workbox strategies

As mentioned, Workbox provides a set of built-in strategies to respond to network requests. The following chart helps us see the adoption of the most popular runtime caching strategies:

{{ figure_markup(
  image="pwa-workbox-runtime-caching-strategies.png",
  caption="Top Workbox runtime caching strategies.",
  description="Bar chart showing popular runtime caching strategies packages by desktop and mobile. `NetworkFirst` is the caching strategy 31.52% of the time on desktop and 31.71% on mobile, `CacheFirst` by 31.72% and 30.51%, `StaleWhileRevalidate` by 27.03% and 26.74%, `NetworkOnly` by 8.81% and 9.66%, and finally `CacheOnly` by 0.92% and 1.37%.", chart_url="https://docs.google.com/spreadsheets/d/e/2PACX-1vTHHnqNdpRUjoeTfsN9_irK57PvZn_Q2X842RLl-RL4ibWmZFvO-S1x35PjVE3-xUlHFS_Zurd22rOq/pubchart?oid=761410022&format=interactive",
  sheets_gid="1537625006",
  sql_file="workbox_methods.sql"
  )
}}

<a hreflang="en" href="https://developers.google.com/web/tools/workbox/modules/workbox-strategies#network_first_network_falling_back_to_cache">`NetworkFirst`</a>, <a hreflang="en" href="https://developers.google.com/web/tools/workbox/modules/workbox-strategies#cache_first_cache_falling_back_to_network">`CacheFirst`</a> and <a hreflang="en" href="https://developers.google.com/web/tools/workbox/modules/workbox-strategies#stale-while-revalidate">`Stale While Revalidate`</a> are, by far, the most widely used. These strategies let you respond to requests by combining the network and the cache in different ways. For example: the most popular runtime caching strategy: `NetworkFirst` will try to fetch the latest response from the network. If the result is successful, it will put the result in the cache. If the network fails, the cache response will be used.

Other strategies, like <a hreflang="en" href="https://developers.google.com/web/tools/workbox/modules/workbox-strategies#network_only">`NetworkOnly`</a> and <a hreflang="en" href="https://developers.google.com/web/tools/workbox/modules/workbox-strategies#cache_only">`CacheOnly`</a> will resolve a `fetch()` request by going either to the network or cache, without combining these two options. This might make them less attractive for PWAs, but there are still some use cases where they make sense. For example, they can be combined with <a hreflang="en" href="https://developers.google.com/web/tools/workbox/modules/workbox-strategies#using_plugins">plugins</a> to extend their functionality.

## Web Push notifications

Web Push notifications are one of the most powerful ways of keeping users engaged in a PWA. They can be sent to mobile and desktop users and can be received even when the web app is not in the foreground or even opened (either as a standalone app or in a browser tab).

Here are some usage stats for some most popular notification-related APIs:

Pages subscribe to notifications via the [`PushManager`](https://developer.mozilla.org/en-US/docs/Web/API/PushManager) interface of the [Push API](https://developer.mozilla.org/en-US/docs/Web/API/Push_API), which is accessed via the `pushManager` property of the [`ServiceWorkerRegistration`](https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerRegistration) interface. It's used by 44.14% of desktop and 45.09% of mobile PWAs.

{{ figure_markup(
  caption="Percent of mobile sites with service workers that some method of the `pushManager` property",
  content="45.09%",
  classes="big-number",
  chart_url="https://docs.google.com/spreadsheets/d/e/2PACX-1vTHHnqNdpRUjoeTfsN9_irK57PvZn_Q2X842RLl-RL4ibWmZFvO-S1x35PjVE3-xUlHFS_Zurd22rOq/pubchart?oid=1163792530&format=interactive",
  sheets_gid="504745822",
  sql_file="sw_registration_properties_name_only.sql"
)
}}

Also as shown in [Figure 4](#fig-4) related to service worker events,  the `push` event listener, which is used to receive push messages, is used by 43.88% of desktop and 45.44% of mobile PWAs.

The service worker interface also allows listening to some events to handle user interactions on notifications. [Figure 4](#fig-4) shows that `notificationclick` (which captures clicks on notifications) is used by 45.64% of desktop and 46.62% of mobile PWAs. `notificationclose` is used less frequently: 5.98% of desktop and 6.34% of mobile PWAs. This is expected as there are fewer use cases where it makes sense to listen for the notification "close" event, than for notification "clicks".

<p class="note">Note: It's interesting to see that service worker notification events (e.g., <code>push</code>, <code>notificationclick</code>) have even more usage the <code>pushManager</code> property, which is used, for example, to request permission for web push notifications (via <code>pushManager.subscribe</code>). One of the reasons for this might be that some sites have implemented web push and decided to roll them back at some point, by eliminating the code to request permission for them, but leaving the service worker code unchanged.</p>

### Web Push notification acceptance rates

For a notification to be useful it has to be <a hreflang="en" href="https://developers.google.com/web/fundamentals/push-notifications">timely, precise, and relevant</a>. At the moment of showing the prompt to request permission, the user needs to understand the value of the service. Good notification updates have to provide something useful to the users and related to the reason why the permission was granted.

The following chart comes from the [Chrome UX Report](./methodology#chrome-ux-report) and shows the acceptance rates for notifications permission prompts:

{{ figure_markup(
  image="pwa-notification-acceptance-rates.png",
  caption="Notification acceptance rates.",
  description="Stacked bar chart showing the notification acceptance rates by desktop and mobile. On desktop `accept` is 8.28%, `ignore` is 51.82%, `deny` is 10.70%, and `dismiss` 29.21%. On mobile `accept` is 20.67%, `ignore` is 14.57%, `deny` is 45.32%, and `dismiss` 19.45%.", chart_url="https://docs.google.com/spreadsheets/d/e/2PACX-1vTHHnqNdpRUjoeTfsN9_irK57PvZn_Q2X842RLl-RL4ibWmZFvO-S1x35PjVE3-xUlHFS_Zurd22rOq/pubchart?oid=460718116&format=interactive",
  sheets_gid="1537625006",
  sql_file="pwa_notification_acceptance_rates.sql"
  )
}}

Mobile has a higher acceptance rate than desktop (20.67% vs 8.28%). This suggests that users tend to find mobile notifications more useful. We can attribute this to two reasons: (1) Users are more familiar with notifications on phones than on desktops, and the utility of a notification in the mobile context is more obvious and (2) the mobile UI for the notification prompt is typically more prominent.

Mobile also has a higher "deny" rate than desktop (45.32% vs 10.70%), and desktop users tend to "ignore" notifications more frequently (19.45% in mobile vs. 29.21 in desktop). The reason for this is that the mobile enrollment UI is much more intrusive than desktop, making the user more frequently decide for either accepting or rejecting the notification. Also, on Desktop devices there are situations when, if a user navigates away from the tab the prompt is dismissed, and the decision is recorded as "ignore" the space to click outside of the prompt to "ignore" the prompt is much bigger.

## Distribution

An important aspect of a PWA is that it allows users to access the web experience in ways beyond typing a URL in the browser URL bar. Users can also install the web app in various ways and access it via a home screen icon. This is one of the most engaging features of native apps, that PWAs also make possible.

Ways to distribute this installable experience include:

- Prompting the user to install the PWA via the [add to home screen](https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps/Add_to_home_screen) functionality.
- Uploading the PWA to App Stores by packaging it with <a hreflang="en" href="https://developer.chrome.com/docs/android/trusted-web-activity/">Trusted Web Activity (TWA)</a> (currently available in any Android app store, including Google Play and Microsoft Store).

Next, we'll share some stats related to these techniques, to have an idea of the usage and growth of these trends.

### Add to home screen

So far, we have analyzed the pre-conditions for add to home screen, like having a service worker and an installable web app manifest.

In addition to the browser-provided install experience, developers can provide their own custom install flow directly within the app.

The [`onbeforeinstallprompt`](https://developer.mozilla.org/en-US/docs/Web/API/Window/onbeforeinstallprompt) property of the `Window` object allows the document to capture the event fired when the user is about to be prompted to install a web application. Developers can then decide if they want to show the prompt directly or defer it to show it when they think it's more appropriate.

Our analysis showed that `beforeinstallprompt` is being used in 0.48% of desktop and 0.63% of mobile sites that have a service worker and a manifest.

{{ figure_markup(
  image="pwa-install-events.png",
  caption="PWA install events.",
  description="Stacked bar chart showing the install events used by desktop and mobile PWA sites. `appinstalled` is used by 0.21% of desktop, and 0.22% of mobile, while `beforeinstallprompt` is used by 0.48% of desktop and 0.63% of mobile.", chart_url="https://docs.google.com/spreadsheets/d/e/2PACX-1vTHHnqNdpRUjoeTfsN9_irK57PvZn_Q2X842RLl-RL4ibWmZFvO-S1x35PjVE3-xUlHFS_Zurd22rOq/pubchart?oid=1538269319&format=interactive",
  sheets_gid="840472840",
  sql_file="install_events.sql"
  )
}}

The `BeforeInstallPromptEvent` API is <a hreflang="en" href="https://caniuse.com/mdn-api_beforeinstallpromptevent">not yet available in all browsers</a>, which explains the relatively low usage. Let's take a look now at the percentage of traffic that this represents:

{{ figure_markup(
  link="https://www.chromestatus.com/metrics/feature/timeline/popularity/1436",
  image='pwa-before-install-prompt-page-loads.png',
  caption='Percentage of page view on a page that use `beforeinstallprompt` (Source: <a hreflang="en" href="https://www.chromestatus.com/metrics/feature/timeline/popularity/1436">Chrome Platform Status</a>)',
  description='Time series of page loads from 1st January 2019 until September 2021 showing a growth from 1% to just over 4% with a large growth in January 2021.',
  width=1460,
  height=786
  )
}}

According to <a hreflang="en" href="https://www.chromestatus.com/metrics/feature/timeline/popularity/1436">Chrome Platform Status</a>, the percentage of page loads using this feature <a hreflang="en" href="https://www.chromestatus.com/metrics/feature/timeline/popularity/1436">is near 4%</a>, which suggests that some high traffic sites might be using it. Additionally, we can see that there was a 2.5 percentage point growth in adoption compared to last year.

### App Store distribution

Historically, developers have built web-based mobile applications and uploaded them to App Stores as an alternative to building apps with OS-specific languages (Java or Kotlin for Android, Objective-C or Swift for iOS). The most common approach is to use a cross-platform, hybrid solution like <a hreflang="en" href="https://cordova.apache.org/">Cordova</a> that allows one to write the code once and generate multiple versions of it for various platforms. The resulting code usually uses the <a hreflang="en" href="https://developer.android.com/reference/android/webkit/WebView">WebView</a> to render web content, but also provides a series of non-standard APIs that can access features from the device.

WebView-based apps may look similar to native apps, but certainly there are some caveats. Since a WebView is just a rendering engine, users may have different experiences than in a full browser. The latest browser APIs might not be available and most importantly, cookies are not shareable between WebViews and browsers.

TWAs allow you to package your PWA into a native application shell and upload it to some App Stores. Unlike WebView-based solutions, a TWA is not just a rendering engine; it's the full browser running in fullscreen mode. For that reason, it's feature-complete and evergreen, meaning that it's always up to date and will give you access to the latest web APIs.

Developers can package their PWAs into native apps with TWA directly, <a hreflang="en" href="https://developer.chrome.com/docs/android/trusted-web-activity/integration-guide/">by using Android Studio</a>, but there are several tools that make this task much easier. Next, we'll analyze two of them: PWA Builder and Bubblewrap.

#### PWA Builder

<a hreflang="en" href="https://www.pwabuilder.com/">PWA Builder</a> is an open-source project that can help web developers to build Progressive Web Apps and package them for app stores like the Microsoft Store and Google Play Store. It starts by reviewing a provided URL to check for an available manifest, service worker, and SSL.

[PWA Builder reviewed 200k URLs over a 3-month timeslot](https://twitter.com/pwabuilder/status/1454250060326318082?s=21) and discovered that:

- 75% had a manifest detected
- 11.5% had a service worker detected
- 9.6% are installable PWAs from the browser (manifest and SW and https)

#### Bubblewrap

<a hreflang="en" href="https://github.com/GoogleChromeLabs/bubblewrap">Bubblewrap</a> is a set of tools and libraries designed to help developers to create, build, and update projects for Android apps that launch PWAs using TWA.

By using Bubblewrap, developers don't need to be aware of any details around Android tools (like Android Studio), which makes it very easy to use for web developers.

While we don't have usage stats for Bubblewrap, there are some notable tools that are known to rely on it. For example, PWA Builder and <a hreflang="en" href="https://appmaker.xyz/pwa-to-apk">PWA2APK</a> are powered by Bubblewrap.

## Conclusion

Six years after the term "Progressive Web Apps" was coined, the adoption of its core technologies continues to grow. Service workers will soon control 20% of web traffic, and sites continue adding more capabilities each year.

In 2021, developers have a diverse range of options to build and distribute their web applications, including tools that allow them to take on the most common tasks, and offer easy ways of uploading these experiences to app stores.

Year over year the web continues demonstrating that applications that used to be built only with OS-specific languages can be developed with web technologies and <a hreflang="en" href="https://www.theverge.com/2021/10/26/22738125/adobe-photoshop-illustrator-web-announced">companies continue investing</a> in bringing these app-like experiences to the web.

We hope this analysis will assist you in making more informed decisions around your PWA projects. We are looking forward to seeing how much all these trends will grow in 2022!
