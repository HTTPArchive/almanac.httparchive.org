{% extends "%s/2019/base_chapter.html" % lang %}

<!--{# IMPORTANT!

- `chapter.html` is a "template for templates" used by the `generate_chapters.js` script, hence the strange template syntax (eg, mixing ejs and jinja syntax)
- if you want to modify `chapter.html`, you must also:
  - translate the corresponding language-specific templates (eg `src/templates/<lang>/<year>/chapter.html`)
  - run the generation script to update each chapter template
- if you want to modify the chapter templates (eg `src/templates/<lang>/<year>/chapters/<chapter>.html`):
  - make changes to the markdown content directly (`src/content/<lang>/<year>/<chapter>.md`) because any changes to the chapter templates will be overwritten by the generation script
#}-->

{% set metadata = {"part_number":"I","chapter_number":4,"title":"メディア","description":"2019年版Web Almanacのメディアの章では、画像ファイルのサイズとフォーマット、レスポンシブ画像、クライアントのヒント、遅延読み込み、アクセシビリティ、動画を取り上げています。","authors":["colinbendell","dougsillars"],"reviewers":["ahmadawais","eeeps"],"translators":["ksakae"],"discuss":"1759","results":"https://docs.google.com/spreadsheets/d/1hj9bY6JJZfV9yrXHsoCRYuG8t8bR-CHuuD98zXV7BBQ/","queries":"04_Media","published":"2019-11-11T00:00:00.000Z","last_updated":"2020-07-20T00:00:00.000Z","chapter":"media"} %} {% block date_published %}2019-11-11T00:00:00.000Z{% endblock %} {% block date_modified %}2020-07-20T00:00:00.000Z{% endblock %} {% block index %}
<ul>
  <li>
    <a href="#序章">序章</a>
  </li>

  <li>
    <a href="#画像">画像</a>

    <ul>
      <li>
        <a href="#画像フォーマット">画像フォーマット</a>
      </li>

      <li>
        <a href="#画像ファイルのサイズ">画像ファイルのサイズ</a>
      </li>

      <li>
        <a href="#画像フォーマットの最適化">画像フォーマットの最適化</a>
      </li>

      <li>
        <a href="#レスポンシブ画像">レスポンシブ画像</a>
      </li>

      <li>
        <a href="#htmlマークアップの使用">HTMLマークアップの使用</a>
      </li>

      <li>
        <a href="#サイズの使用">サイズの使用</a>
      </li>

      <li>
        <a href="#クライアントヒント">クライアントヒント</a>
      </li>

      <li>
        <a href="#遅延ローディング">遅延ローディング</a>
      </li>

      <li>
        <a href="#アクセシビリティ">アクセシビリティ</a>
      </li>
    </ul>
  </li>

  <li>
    <a href="#動画">動画</a>

    <ul>
      <li>
        <a href="#動画フォーマット">動画フォーマット</a>
      </li>

      <li>
        <a href="#動画ファイルのサイズ">動画ファイルのサイズ</a>
      </li>

      <li>
        <a href="#動画プレイヤー">動画プレイヤー</a>
      </li>
    </ul>
  </li>

  <li>
    <a href="#結論">結論</a>
  </li>
</ul>

{% endblock %} {% block main_content %}
<h2 id="序章"><a href="#序章" class="anchor-link">序章</a></h2>
<p>画像、アニメーション、動画はウェブ体験の重要な一部です。それらが重要な理由はたくさんあります。ストーリーを伝えたり、視聴者の関心を引きつけたり、他のウェブ技術では簡単には作れないような芸術的な表現を提供したりするのに役立ちます。これらのメディアリソースの重要性は、2つの方法で示すことができます。1つは、1ページのダウンロードに必要なバイト数の多さ、もう1つはメディアで描かれたピクセル数の多さです。</p>
<p>純粋なバイトの観点から見ると、HTTP Archiveは<a href="https://legacy.httparchive.org/interesting.php#bytesperpage">歴史的に報告されている</a>メディアから関連付けられたリソースバイトの平均3分の2を持っています。分布の観点から見ると、事実上すべてのウェブページが画像や動画に依存していることがわかります。10パーセンタイルでさえ、我々はバイトの44％がメディアからであり、ページの90パーセンタイルで総バイトの91％に上昇できることを参照してください。</p>
<figure id="fig-1">
  <a href="/static/images/2019/media/fig1_bytes_images_and_video_versus_other.png">
    <img src="/static/images/2019/media/fig1_bytes_images_and_video_versus_other.png" alt="図1. Webページのバイト：画像と動画対その他。" aria-labelledby="fig1-caption" aria-describedby="fig1-description" width="600" height="371" data-width="600" data-height="371" data-seamless="" data-frameborder="0" data-scrolling="no" data-iframe="https://docs.google.com/spreadsheets/d/e/2PACX-1vSViHIntdF6-bHAI0cl1HelY_X8rR4lf0P3W2Y8I5SyVMxG-ptggTHfWA0qrrU47RvuAydLE6Zex6L3/pubchart?oid=1189524305&amp;format=interactive" loading="lazy" />
  </a>
  <button hidden="" class="fig-description-button" aria-expanded="false" aria-controls="fig1-description" data-show-text="{{ show_description(1) }}" data-hide-text="{{ hide_description(1) }}">{{ show_description(1) }}</button>
  <div id="fig1-description" class="visually-hidden">p10パーセンタイルでページバイトの44.1％がメディア、p25パーセンタイルで52.7％がメディア、p50パーセンタイルで67.0％がメディア、p75パーセンタイルで81.7％がメディア、p90パーセンタイルで91.2％がメディアであることを示す棒グラフです。</div>
  <figcaption id="fig1-caption"><a href="#fig-1" class="anchor-link">図 1.</a> Webページのバイト：画像と動画対その他。</figcaption>
</figure>
<p>メディアは視覚体験には欠かせないものですが、この大量のバイトのインパクトには2つの副作用があります。</p>
<p>まず、これらのバイトをダウンロードするために必要なネットワークのオーバーヘッドは大きく、携帯電話や低速ネットワーク環境（コーヒーショップやUberに乗っているときのテザリングのような）では劇的にページの<a href="./performance">パフォーマンス</a>を遅くできます。画像はブラウザによる優先度の低いリクエストですが、ダウンロード中のCSSやJavaScriptを簡単にブロックできます。これ自体がページのレンダリングを遅らせることになります。しかし、画像コンテンツは、ページの準備ができたことをユーザーに視覚的に伝える手がかりとなります。そのため、画像コンテンツの転送が遅いと、ウェブページが遅いという印象を与えることがあります。</p>
<p>2つ目の影響は、ユーザーへの金銭的なコストです。これはウェブサイトの所有者の負担ではなく、エンドユーザーの負担となるため、しばしば無視されがちな側面です。逸話として、<a href="https://twitter.com/yoavweiss/status/1195036487538003968?s=20">日本のような</a>という市場では、データの上限に達した月末近くは学生の購買意欲が低下し、ユーザーはビジュアルコンテンツを見ることができなくなるということが伝えられています。</p>
<p>さらに、世界のさまざまな地域でこれらのウェブサイトを訪問するための金銭的コストは不釣り合いです。中央値と90パーセンタイルでは、画像のバイト数はそれぞれ1MBと1.9MBです。<a href="https://whatdoesmysitecost.com/#gniCost">WhatDoesMySiteCost.com</a>を使用すると、マダガスカルのユーザーの一人当たりの国民総所得（GNI）コストは90パーセンタイルでウェブページを1回読み込んだだけで、一日の総所得の2.6％になることがわかります。対照的に、ドイツでは、これは1日の総所得の0.3％になります。</p>
<figure id="fig-2">
  <a href="/static/images/2019/media/fig2_total_image_bytes_per_web_page_mobile.png">
    <img src="/static/images/2019/media/fig2_total_image_bytes_per_web_page_mobile.png" alt="図2. ウェブページあたりの総画像バイト数（モバイル）。" aria-labelledby="fig2-caption" aria-describedby="fig2-description" width="600" height="371" data-width="600" data-height="371" data-seamless="" data-frameborder="0" data-scrolling="no" data-iframe="https://docs.google.com/spreadsheets/d/e/2PACX-1vSViHIntdF6-bHAI0cl1HelY_X8rR4lf0P3W2Y8I5SyVMxG-ptggTHfWA0qrrU47RvuAydLE6Zex6L3/pubchart?oid=2025280105&amp;format=interactive" loading="lazy" />
  </a>
  <button hidden="" class="fig-description-button" aria-expanded="false" aria-controls="fig2-description" data-show-text="{{ show_description(2) }}" data-hide-text="{{ hide_description(2) }}">{{ show_description(2) }}</button>
  <div id="fig2-description" class="visually-hidden">モバイルの中央値のウェブページでは、90パーセンタイルで1MBの画像と4.9MBの画像が必要です。</div>
  <figcaption id="fig2-caption"><a href="#fig-2" class="anchor-link">図 2.</a> ウェブページあたりの総画像バイト数（モバイル）。</figcaption>
</figure>
<p>ページあたりのバイト数を見ると、ページパフォーマンスとユーザーに対するコストだけを見ることになりますが、それは利点を見落としています。これらのバイトは、画面上のピクセルをレンダリングするために重要です。このように、1ページあたりに使用されるメディアのピクセル数を見ることで、画像や動画リソースの重要性を見ることができます。</p>
<p>ピクセル量を見るときに考慮すべき3つのメトリクスがあります。CSSピクセル、ナチュラルピクセル、スクリーンピクセルです。</p>
<ul>
  <li>
    <p><em>CSSピクセルボリューム</em> はCSSの観点からのレイアウトです。この尺度は、画像や動画を引き伸ばしたり、押し込んだりできる境界ボックスに焦点を当てています。また、実際のファイルのピクセルや画面表示のピクセルは考慮されていません。</p>
  </li>
  <li>
    <p><em>ナチュラルピクセル</em> とは、 ファイル内で表現される論理的なピクセルのことを指します。この画像をGIMPやPhotoshopで読み込んだ場合、ピクセルファイルの寸法は自然なピクセルとなります。</p>
  </li>
  <li>
    <p><em>スクリーンピクセル</em> とは、ディスプレイ上の物理的な電子機器を指します。携帯電話や最新の高解像度ディスプレイが登場する以前は、CSSピクセルとスクリーン上のLEDポイントの間には1:1の関係がありました。しかし、モバイルデバイスは目に近づけられ、ノートPCの画面は昔のメインフレーム端末よりも近づけられているため、現代のスクリーンは従来のCSSピクセルに対する物理ピクセルの比率が高くなっています。この比率は、Device-Pixel-Ratio、または口語でRetina™ディスプレイと呼ばれています。</p>
  </li>
</ul>
<figure id="fig-3">
  <a href="/static/images/2019/media/fig3_image_pixel_per_page_mobile_css_v_actual.png">
    <img src="/static/images/2019/media/fig3_image_pixel_per_page_mobile_css_v_actual.png" alt="図3. 1ページあたりのピクセル画像（モバイル）。CSS対実物。" aria-labelledby="fig3-caption" aria-describedby="fig3-description" width="600" height="371" data-width="600" data-height="371" data-seamless="" data-frameborder="0" data-scrolling="no" data-iframe="https://docs.google.com/spreadsheets/d/e/2PACX-1vSViHIntdF6-bHAI0cl1HelY_X8rR4lf0P3W2Y8I5SyVMxG-ptggTHfWA0qrrU47RvuAydLE6Zex6L3/pubchart?oid=2027393897&amp;format=interactive" loading="lazy" />
  </a>
  <button hidden="" class="fig-description-button" aria-expanded="false" aria-controls="fig3-description" data-show-text="{{ show_description(3) }}" data-hide-text="{{ hide_description(3) }}">{{ show_description(3) }}</button>
  <div id="fig3-description" class="visually-hidden">画像コンテンツに割り当てられているCSSの画素数を、実際の画像の画素数と比較した結果、p10（実測は0.07MP、CSSは0.04MP）、p25（実測は0.38MP、CSSは0.18MP）、p50（実測は1.6MP、CSSは0.65MP）、p75（実測は5.1MP、CSSは1.8MP）、p90（実測は12MP、CSSは4.6MP）が表示されていることがわかります。</div>
  <figcaption id="fig3-caption"><a href="#fig-3" class="anchor-link">図 3.</a> 1ページあたりのピクセル画像（モバイル）。CSS対実物。</figcaption>
</figure>
<figure id="fig-4">
  <a href="/static/images/2019/media/fig4_image_pixel_per_page_desktop_css_v_actual.png">
    <img src="/static/images/2019/media/fig4_image_pixel_per_page_desktop_css_v_actual.png" alt="図4. 1ページあたりのピクセル画像（デスクトップ）。CSS対実物。" aria-labelledby="fig4-caption" aria-describedby="fig4-description" width="600" height="371" data-width="600" data-height="371" data-seamless="" data-frameborder="0" data-scrolling="no" data-iframe="https://docs.google.com/spreadsheets/d/e/2PACX-1vSViHIntdF6-bHAI0cl1HelY_X8rR4lf0P3W2Y8I5SyVMxG-ptggTHfWA0qrrU47RvuAydLE6Zex6L3/pubchart?oid=1364487787&amp;format=interactive" loading="lazy" />
  </a>
  <button hidden="" class="fig-description-button" aria-expanded="false" aria-controls="fig4-description" data-show-text="{{ show_description(4) }}" data-hide-text="{{ hide_description(4) }}">{{ show_description(4) }}</button>
  <div id="fig4-description" class="visually-hidden">画像コンテンツに割り当てられたCSSの画素数をデスクトップ用の実際の画像の画素数と比較した結果、p10（実際は0.09MP、CSSは0.05MP）、p25（実際は0.52MP、CSSは0.29MP）、p50（実際は2.1MP、CSSは1.1MP）、p75（実際は6.0MP、CSSは2.8MP）、p90（実際は14MP、CSSは6.3MP）が表示されています。</div>
  <figcaption id="fig4-caption"><a href="#fig-4" class="anchor-link">図 4.</a> 1ページあたりのピクセル画像（デスクトップ）。CSS対実物。</figcaption>
</figure>
<p>CSSピクセルと自然ピクセル量を見ると、中央値のウェブサイトは1メガピクセル (MP) のメディア コンテンツを表示するレイアウトになっていることがわかります。90パーセンタイルでは、CSSレイアウトのピクセル量はモバイルで4.6MP、デスクトップで6.3MPに増加しています。これはレスポンシブレイアウトが、異なる可能性が高いだけでなく、フォームファクターが異なることも興味深い。要するに、モバイルレイアウトはデスクトップに比べてメディアに割り当てられるスペースが少ないということです。</p>
<p>対照的に、ナチュラル（ファイル）ピクセル量はレイアウト量の2～2.6倍です。デスクトップウェブページの中央値は2.1MPのピクセルコンテンツを送信し、1.1MPのレイアウトスペースに表示されます。モバイルでは、90パーセンタイルの割合で12MPが4.6MPに圧縮されていることがわかります。</p>
<p>もちろん、モバイルデバイスのフォームファクターはデスクトップとは異なります。デスクトップが大きく主に横向きで使用されるのに対し、モバイルデバイスは小さく通常縦向きで使用されます。前述したように、モバイルデバイスは目から近い位置にあるため、一般的にデバイスピクセル比（DPR）が高く、タイムズスクエアのビルボードに必要なピクセル数と比べて1インチあたりのピクセル数が多く必要となります。これらの違いにより、レイアウトの変更を余儀なくされ、モバイルのユーザーはコンテンツの全体を消費するためにサイトをスクロールするのが一般的です。</p>
<p>メガピクセルは、主に抽象的な指標であるため、難しい指標です。ウェブページで使用されているピクセルの量を表現するのに便利な方法は、ディスプレイサイズに対する比率として表現することです。</p>
<p>ウェブページのクロールで使用したモバイル端末では、<code>512 x 360</code>の表示で、0.18MPのCSSコンテンツが表示されています（物理的な画面である<code>3x</code>や3^2以上の画素である1.7MPと混同しないように）。このビューアーのピクセル量を画像に割り当てられたCSSピクセルの数で割ると、相対的なピクセル量が得られます。</p>
<p>もし、画面全体を完璧に埋め尽くす画像が1枚あったとしたら、これは1xピクセルの塗りつぶし率になります。もちろん、ウェブサイトが1枚の画像でキャンバス全体を埋め尽くすことはほとんどありません。メディアコンテンツは、デザインや他のコンテンツと混在する傾向があります。1xよりも大きい値はレイアウトが追加の画像コンテンツを見るため、ユーザーが、スクロールする必要があることを意味します。</p>
<p class="note">注：これは、viperとレイアウトコンテンツのボリュームの両方のCSSレイアウトを見ているだけです。レスポンシブ画像の効果や、DPRの高いコンテンツを提供することの効果を評価しているわけではありません。</p>
<figure id="fig-5">
  <a href="/static/images/2019/media/fig5_image_pixel_volume_v_css_pixels.png">
    <img src="/static/images/2019/media/fig5_image_pixel_volume_v_css_pixels.png" alt="図5. 画像のピクセル量と画面サイズ（CSSピクセル）の関係。" aria-labelledby="fig5-caption" aria-describedby="fig5-description" width="600" height="371" data-width="600" data-height="371" data-seamless="" data-frameborder="0" data-scrolling="no" data-iframe="https://docs.google.com/spreadsheets/d/e/2PACX-1vSViHIntdF6-bHAI0cl1HelY_X8rR4lf0P3W2Y8I5SyVMxG-ptggTHfWA0qrrU47RvuAydLE6Zex6L3/pubchart?oid=1889020047&amp;format=interactive" loading="lazy" />
  </a>
  <button hidden="" class="fig-description-button" aria-expanded="false" aria-controls="fig5-description" data-show-text="{{ show_description(5) }}" data-hide-text="{{ hide_description(5) }}">{{ show_description(5) }}</button>
  <div id="fig5-description" class="visually-hidden">実際の画面サイズCSSピクセルと比較したページあたりに必要なピクセル量の比較では、p10（モバイル20%、デスクトップ2%）、p25（モバイル97%、デスクトップ13%）、p50（モバイル354%、デスクトップ46%）、p75（モバイル1003%、デスクトップ123%）、およびp90（モバイル2477%、デスクトップ273%）が示されています。</div>
  <figcaption id="fig5-caption"><a href="#fig-5" class="anchor-link">図 5.</a> 画像のピクセル量と画面サイズ（CSSピクセル）の関係。</figcaption>
</figure>
<p>デスクトップの中央値のウェブページでは、画像や動画を含むレイアウトが表示されるのはディスプレイの46％に過ぎません。対照的に、モバイルでは、メディアピクセルの量が実際のビューポートサイズの3.5倍を埋めています。レイアウトは、1つの画面で埋められる以上のコンテンツがあり、ユーザーはスクロールする必要があります。最低でも、1サイトあたり3.5ページ分のコンテンツがスクロールしていることになります（飽和度100％を想定）。モバイルの90パーセンタイルでは、これはビューポートサイズの25倍にまで大幅に拡大します！</p>
<p>メディアリソースは、ユーザーエクスペリエンスにとって非常に重要です。</p>
<h2 id="画像"><a href="#画像" class="anchor-link">画像</a></h2>
<p>バイトの削減とユーザー体験の最適化に役立つ画像の管理と最適化については、すでに多くのことが書かれています。ブランド体験を定義するのはクリエイティブなメディアであるため、多くの人にとって重要かつクリティカルなトピックとなっています。したがって画像や動画コンテンツの最適化は、意図した体験の忠実性を維持しながら、ネットワーク上で転送されるバイト数を減らすのに役立つベストプラクティスを適用することとの間のバランスをとる行為です。</p>
<p>画像、動画、アニメーションに利用されている戦略は、大まかに似ていますが、具体的なアプローチは大きく異なります。一般的には、これらの戦略は次のようなものです。</p>
<ul>
  <li><strong>ファイル形式</strong> - 最適なファイル形式を利用</li>
  <li><strong>レスポンシブ</strong> - レスポンシブ画像技術を適用して、画面に表示されるピクセルだけを転送する</li>
  <li><strong>遅延ローディング</strong> - 人が見たときだけコンテンツを転送する</li>
  <li><strong>アクセシビリティ</strong> - 全人類に一貫した体験を提供する</li>
</ul>
<p class="note">これらの結果を解釈する際には注意が必要です。Web Almanacのためにクロールされたウェブページは、Chromeブラウザでクロールされました。これは、SafariやFirefoxに適したコンテンツネゴシエーションが、このデータセットでは表現されていない可能性があることを意味しています。例えば、JPEG2000、JPEG-XR、HEVC、HEICなどのファイル形式は、Chromeではネイティブにサポートされていないため、使用されていません。これは、ウェブにこれらの他の形式や経験が含まれていないことを意味するものではありません。同様に、Chrome には遅延読み込みのネイティブサポートがあります（v76 以降）が、他のブラウザではまだ利用できません。これらの注意事項については、<a href="./methodology">方法論</a>をご覧ください。</p>
<p>画像を利用していないウェブページを見つけることは稀です。長年にわたり、ウェブ上でコンテンツを表示するためのさまざまなファイルフォーマットが登場してきましたが、それぞれが異なる問題に対処してきました。主に4つの普遍的な画像フォーマットがあります。JPEG、PNG、GIF、およびSVGです。さらに、Chromeではメディア パイプラインが強化され、5つ目の画像フォーマットのサポートが追加されました。WebP。他のブラウザでも同様にJPEG2000（Safari）、JPEG-XL（IEとEdge）、HEIC（SafariではWebViewのみ）のサポートが追加されています。</p>
<p>それぞれのフォーマットにはそれぞれメリットがあり、Web上での理想的な使い方があります。とても簡単にまとめると以下のようになります。</p>
<figure id="fig-6">
  <div class="table-wrap">
    <div class="table-wrap-container">
      <table>
        <thead>
          <tr>
            <th>フォーマット</th>
            <th class="width-45">ハイライト</th>
            <th class="width-45">欠点</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>JPEG</td>
            <td>
              <ul>
                <li>ユビキタスに対応</li>
                <li>写真コンテンツに最適</li>
              </ul>
            </td>
            <td>
              <ul>
                <li>常に品質の損失がある</li>
                <li>ほとんどのデコーダは、最新のカメラからの高ビット深度の写真を扱うことができません（チャンネルあたり8ビット以上）</li>
                <li>透明性のサポートはありません</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>PNG</td>
            <td>
              <ul>
                <li>JPEGやGIFのように、幅広いサポートを共有しています</li>
                <li>ロスレスです</li>
                <li>透明度、アニメーション、高ビット深度をサポート</li>
              </ul>
            </td>
            <td>
              <ul>
                <li>JPEGに比べてはるかに大きなファイル</li>
                <li>写真コンテンツには理想的ではない</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>GIF</td>
            <td>
              <ul>
                <li>PNGの前身Gは、アニメーションで最もよく知られています。</li>
                <li>ロスレス</li>
              </ul>
            </td>
            <td>
              <ul>
                <li>256色の制限があるため、変換による視覚的な損失が常にあります</li>
                <li>アニメーション用の非常に大きなファイル</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>SVG</td>
            <td>
              <ul>
                <li>ファイルサイズを増やさずにリサイズできるベクターベースのフォーマット</li>
                <li>ピクセルではなく数学に基づいており、滑らかな線を作成します</li>
              </ul>
            </td>
            <td>
              <ul>
                <li>写真やその他のラスターコンテンツには有用ではない</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>WebP</td>
            <td>
              <ul>
                <li>PNGのようなロスレス画像とJPEGのようなロスレス画像を生成することができる新しいファイル形式です</li>
                <li><a href="https://developers.google.com/speed/webp/faq">JPEGと比較して平均30%のファイル削減率を誇っています</a>が、他のデータでは、ファイル削減率の中央値は<a href="https://cloudinary.com/state-of-visual-media-report/">ピクセル量に基づいて10-28%の間であることが示唆されています</a></li>
              </ul>
            </td>
            <td>
              <ul>
                <li>JPEGとは異なり、一部の画像がぼやけて見えるクロマサブサンプリングに限定されます</li>
                <li>普遍的にサポートされているわけではありません。Chrome、Firefox、Androidのエコシステムのみ</li>
                <li>ブラウザのバージョンに応じて断片化された機能のサポート</li>
              </ul>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <figcaption><a href="#fig-6" class="anchor-link">図 6.</a> 主流のファイル形式の説明。</figcaption>
</figure>
<h3 id="画像フォーマット"><a href="#画像フォーマット" class="anchor-link">画像フォーマット</a></h3>
<p>すべてのページを見てみると、これらのフォーマットの普及率が、高いことがわかります。ウェブ上でもっとも古いフォーマットの1つであるJPEGは画像リクエストの60％、全画像バイトの65％で圧倒的に、もっとも一般的に使用されている画像フォーマットです。興味深いことに、PNGは画像要求とバイト数の28％で2番目によく使われている画像フォーマットです。色の正確さやクリエイティブなコンテンツの精度に加えて、サポートがどこにでもあることが広く使われている理由と考えられます。対照的に、SVG、GIF、WebPは4％とほぼ同じ使用率です。</p>
<figure id="fig-7">
  <a href="/static/images/2019/media/fig7_image_format_usage.png">
    <img alt="Most frequent Image types used on web pages" aria-labelledby="fig7-caption" aria-describedby="fig7-description" src="/static/images/2019/media/fig7_image_format_usage.png" width="600" height="376" loading="lazy" />
  </a>
  <button hidden="" class="fig-description-button" aria-expanded="false" aria-controls="fig7-description" data-show-text="{{ show_description(7) }}" data-hide-text="{{ hide_description(7) }}">{{ show_description(7) }}</button>
  <div id="fig7-description" class="visually-hidden">ツリーマップを見ると、JPEGが60.27％、PNGが28.2％、WebPが4.2％、GIFが3.67％、SVGが3.63％となっています。</div>
  <figcaption id="fig7-caption"><a href="#fig-7" class="anchor-link">図 7.</a> 画像フォーマットの使用法</figcaption>
</figure>
<p>もちろん、ウェブページの画像コンテンツの使い方は一様でありません。画像に依存しているページもあれば、いくつかは他よりも画像に依存しています。<code>google.com</code>のホームページを見てみると、一般的なニュースサイトに比べて画像はほとんどないことがわかります。実際、中央値のウェブサイトには13枚の画像があり、90パーセンタイルでは61枚、99パーセンタイルでは229枚の画像があります。</p>
<figure id="fig-8">
  <a href="/static/images/2019/media/fig8_image_format_usage_per_page.png">
    <img src="/static/images/2019/media/fig8_image_format_usage_per_page.png" alt="Figure 8. Image format usage per page." aria-labelledby="fig8-caption" aria-describedby="fig8-description" width="600" height="371" data-width="600" data-height="371" data-seamless="" data-frameborder="0" data-scrolling="no" data-iframe="https://docs.google.com/spreadsheets/d/e/2PACX-1vSViHIntdF6-bHAI0cl1HelY_X8rR4lf0P3W2Y8I5SyVMxG-ptggTHfWA0qrrU47RvuAydLE6Zex6L3/pubchart?oid=294858455&amp;format=interactive" loading="lazy" />
  </a>
  <button hidden="" class="fig-description-button" aria-expanded="false" aria-controls="fig8-description" data-show-text="{{ show_description(8) }}" data-hide-text="{{ hide_description(8) }}">{{ show_description(8) }}</button>
  <div id="fig8-description" class="visually-hidden">p10パーセンタイルでは画像フォーマットが全く使用されていないことを示す棒グラフ、p25パーセンタイルではJPGが3枚とPNGが4枚、p50パーセンタイルではJPGが9枚、PNGが4枚、GIFが1枚、p75パーセンタイルではJPEGが39枚、PNGが18枚、SVGが2枚、GIFが2枚、p99パーセンタイルではJPGが119枚、PNGが49枚、WebPが28枚、SVGが19枚、GIFが14枚使用されていることを示しています。</div>
  <figcaption id="fig8-caption"><a href="#fig-8" class="anchor-link">図 8.</a> 1ページあたりの画像フォーマットの使用量</figcaption>
</figure>
<p>中央値のページではJPEGが9枚、PNGが4枚となっており、GIFが使用されているのは上位25％のページのみで、採用率は報告されていません。1ページあたりの各フォーマットの使用頻度は、より近代的なフォーマットの採用についての洞察を提供していません。具体的には、各フォーマットに少なくとも1枚の画像が含まれているページの割合は？</p>
<figure id="fig-9">
  <a href="/static/images/2019/media/fig9_pages_using_at_least_1_image.png">
    <img src="/static/images/2019/media/fig9_pages_using_at_least_1_image.png" alt="図9. 少なくとも1枚の画像を使用しているページの割合。" aria-labelledby="fig9-caption" aria-describedby="fig9-description" width="600" height="371" data-width="600" data-height="371" data-seamless="" data-frameborder="0" data-scrolling="no" data-iframe="https://docs.google.com/spreadsheets/d/e/2PACX-1vSViHIntdF6-bHAI0cl1HelY_X8rR4lf0P3W2Y8I5SyVMxG-ptggTHfWA0qrrU47RvuAydLE6Zex6L3/pubchart?oid=1024386063&amp;format=interactive" loading="lazy" />
  </a>
  <button hidden="" class="fig-description-button" aria-expanded="false" aria-controls="fig9-description" data-show-text="{{ show_description(9) }}" data-hide-text="{{ hide_description(9) }}">{{ show_description(9) }}</button>
  <div id="fig9-description" class="visually-hidden">棒グラフで見ると、90%のページでJPEGが使用されており、89%がPNG、9%がWebP、37%がGIF、22%がSVGとなっています。</div>
  <figcaption id="fig9-caption"><a href="#fig-9" class="anchor-link">図 9.</a> 少なくとも1枚の画像を使用しているページの割合。</figcaption>
</figure>
<p>これは、90パーセンタイルのページでさえWebPの頻度がゼロである理由を説明するのに役立ちます。WebPがイメージに適していない理由はたくさんありますが、メディアのベストプラクティスの採用は、WebP自体の採用のようにまだ初期段階にとどまっています。</p>
<h3 id="画像ファイルのサイズ"><a href="#画像ファイルのサイズ" class="anchor-link">画像ファイルのサイズ</a></h3>
<p>画像ファイルのサイズを見るには、リソースあたりの絶対バイト数とピクセルあたりのバイト数の2つの方法があります。</p>
<figure id="fig-10">
  <a href="/static/images/2019/media/fig10_image_format_size.png">
    <img alt="A comparison of image formats by file size" aria-labelledby="fig10-caption" aria-describedby="fig10-description" src="/static/images/2019/media/fig10_image_format_size.png" width="600" height="371" loading="lazy" />
  </a>
  <button hidden="" class="fig-description-button" aria-expanded="false" aria-controls="fig10-description" data-show-text="{{ show_description(10) }}" data-hide-text="{{ hide_description(10) }}">{{ show_description(10) }}</button>
  <div id="fig10-description" class="visually-hidden">p10パーセンタイルではJPEGの4KB、PNGの2KB、GIFの2KBが使用され、p25パーセンタイルではJPGの9KB、PNGの4KB、WebPの7KB、GIFの3KBが使用され、p50パーセンタイルではJPGの24KB、PNGの11KB、WebPの17KB、GIFの6KBが使用されていることを示すチャート。SVGの1KBが使用され、p75パーセンタイルではJPEGの68KB、PNGの43KB、WebPの41KB、GIFの17KB、SVGの2KBが使用され、p90パーセンタイルではJPGの116KB、PNGの152KB、WebPの90KB、GIFの87KB、SVGの8KBが使用されています。</div>
  <figcaption id="fig10-caption"><a href="#fig-10" class="anchor-link">図 10.</a> 画像形式別のファイルサイズ（KB）。</figcaption>
</figure>
<p>このことから、ウェブ上の典型的なリソースの大きさや小ささを知ることができます。しかし、これではこれらのファイル分布の画面上で表現されているピクセルの量を知ることはできません。これを行うには、各リソースのバイト数を画像の自然なピクセル数で割ることができます。1ピクセルあたりのバイト数が低いほど、視覚コンテンツの伝送効率が高いことを示しています。</p>
<figure id="fig-11">
  <a href="/static/images/2019/media/fig11_bytes_per_pixel.png">
    <img src="/static/images/2019/media/fig11_bytes_per_pixel.png" alt="図11. ピクセルあたりのバイト数。" aria-labelledby="fig11-caption" aria-describedby="fig11-description" width="600" height="371" data-width="600" data-height="371" data-seamless="" data-frameborder="0" data-scrolling="no" data-iframe="https://docs.google.com/spreadsheets/d/e/2PACX-1vSViHIntdF6-bHAI0cl1HelY_X8rR4lf0P3W2Y8I5SyVMxG-ptggTHfWA0qrrU47RvuAydLE6Zex6L3/pubchart?oid=1379541850&amp;format=interactive" loading="lazy" />
  </a>
  <button hidden="" class="fig-description-button" aria-expanded="false" aria-controls="fig11-description" data-show-text="{{ show_description(11) }}" data-hide-text="{{ hide_description(11) }}">{{ show_description(11) }}</button>
  <div id="fig11-description" class="visually-hidden">ローソク足チャートは、p10パーセンタイルでは、JPEGが0.1175byte/pixel、PNGが0.1197byte/pixel、GIFが0.1702byte/pixel、WebPが0.0586byte/pixel、SVGが0.0293byte/pixelであることを示しています。p25パーセンタイルでは、JPEGが0.1848byte/pixel、PNGが0.2874byte/pixel、GIFが0.3641byte/pixel、WebPが0.1025byte/pixel、SVGが0.174byte/pixelとなっています。p50パーセンタイルでは、JPEGが0.2997byte/pixel、PNGが0.6918byte/pixel、GIFが0.7967byte/pixel、WebPが0.183byte/pixel、SVGが0.6766byte/pixelとなっています。p75パーセンタイルでは、JPEGが0.5456byte/pixel、PNGが1.4548byte/pixel、GIFが2.515byte/pixel、WebPが0.3272byte/pixel、SVGが1.9261byte/pixelとなっています。p90パーセンタイルでは、JPEGが0.9822byte/pixel、PNGが2.5026byte/pixel、GIFが8.5151byte/pixel、WebPが0.6474byte/pixel、SVGが4.1075byte/pixelとなっています。</div>
  <figcaption id="fig11-caption"><a href="#fig-11" class="anchor-link">図 11.</a> ピクセルあたりのバイト数。</figcaption>
</figure>
<p>以前はGIFファイルがJPEGよりも小さいと思われていましたが、今ではJPEGのリソースが大きくなった原因はピクセルボリュームにあることがはっきりとわかります。おそらく、GIFが他のフォーマットと比較して非常に低いピクセル密度を示していることは驚きではありません。さらにPNGは高いビット深度を扱うことができ、クロマサブサンプリングのぼやけに悩まされることはありませんが、同じピクセルボリュームではJPGやWebPの約2倍のサイズになります。</p>
<p>なお、SVGに使用されるピクセル量は、画面上のDOM要素のサイズ（CSSピクセル）です。ファイルサイズの割にはかなり小さいですが、これは一般的にSVGがレイアウトの小さい部分で使用されていることを示唆しています。これが、PNGよりも1ピクセルあたりのバイト数が悪く見える理由です。</p>
<p>繰り返しになりますが、この画素密度の比較は、同等の画像を比較しているわけではありません。むしろ、典型的なユーザー体験を報告しているのです。次に説明するように、これらの各フォーマットでも、ピクセルあたりのバイト数をさらに最適化して減らすために使用できる技術があります。</p>
<h3 id="画像フォーマットの最適化"><a href="#画像フォーマットの最適化" class="anchor-link">画像フォーマットの最適化</a></h3>
<p>体験に最適なフォーマットを選択することは、フォーマットの能力のバランスをとり、総バイト数を減らすことです。ウェブページの場合、画像を最適化することでウェブパフォーマンスを向上させることが1つの目標です。しかし、それぞれのフォーマットには、バイト数を減らすのに役立つ追加機能があります。</p>
<p>いくつかの機能は、総合的な体験に影響を与えることができます。たとえばJPEGやWebPでは、<em>量子化</em>（一般的には<em>品質レベル</em>と呼ばれる）や <em>クロマサブサンプリング</em> を利用でき、視覚的な体験に影響を与えることなく、画像に格納されているビット数を減らすことができます。音楽用のMP3のように、この技術は人間の目のバグに依存しており、カラーデータが失われるにもかかわらず同じ体験を可能にします。しかし、すべての画像がこれらの技術に適しているわけではありません。</p>
<p>他のフォーマット機能は、単にコンテンツを整理するだけで、時には文脈に沿った知識を必要とします。たとえばJPEGのプログレッシブエンコーディングを適用すると、ピクセルはスキャンレイヤーに再編成されブラウザはより早くレイアウトを完成させることができ、同時にピクセル量を減らすことができます。</p>
<p>1つの<a href="./methodology#lighthouse">Lighthouse</a>テストは、ベースラインとプログレッシブにエンコードされたJPEGをA/Bで比較するものです。これは画像全体がロスレス技術でさらに最適化されるか、また異なる品質レベルを使用するなど、潜在的には不可逆技術で最適化されるかどうかを示すための気付きを提供しています。</p>
<figure id="fig-12">
  <a href="/static/images/2019/media/fig12_percentage_optimized_images.png">
    <img src="/static/images/2019/media/fig12_percentage_optimized_images.png" alt="図12. 「最適化された」画像の割合。" aria-labelledby="fig12-caption" aria-describedby="fig12-description" width="600" height="371" data-width="600" data-height="371" data-seamless="" data-frameborder="0" data-scrolling="no" data-iframe="https://docs.google.com/spreadsheets/d/e/2PACX-1vSViHIntdF6-bHAI0cl1HelY_X8rR4lf0P3W2Y8I5SyVMxG-ptggTHfWA0qrrU47RvuAydLE6Zex6L3/pubchart?oid=1569150767" loading="lazy" />
  </a>
  <button hidden="" class="fig-description-button" aria-expanded="false" aria-controls="fig12-description" data-show-text="{{ show_description(12) }}" data-hide-text="{{ hide_description(12) }}">{{ show_description(12) }}</button>
  <div id="fig12-description" class="visually-hidden">p10パーセンタイルでは100%の画像が最適化されており、p25パーセンタイルでも同様で、p50パーセンタイルでは98%の画像が最適化されており（2%は最適化されていない）、p75パーセンタイルでは83%の画像が最適化されており（17%は最適化されていない）、p90パーセンタイルでは59%の画像が最適化されており、41%の画像が最適化されていないことを示す棒グラフです。</div>
  <figcaption id="fig12-caption"><a href="#fig-12" class="anchor-link">図 12.</a> 「最適化された」画像の割合。</figcaption>
</figure>
<p>このAB Lighthouseテストでの節約は、p95で数MBに達することができる潜在的なバイトの節約だけでなく、ページパフォーマンスの向上を実証しています。</p>
<figure id="fig-13">
  <a href="/static/images/2019/media/fig13_project_perf_improvements_image_optimization.png">
    <img src="/static/images/2019/media/fig13_project_perf_improvements_image_optimization.png" alt="図13. Lighthouseからの画像最適化によるページパフォーマンスの向上を予測。" aria-labelledby="fig12-caption" aria-describedby="fig13-description" width="600" height="371" data-width="600" data-height="371" data-seamless="" data-frameborder="0" data-scrolling="no" data-iframe="https://docs.google.com/spreadsheets/d/e/2PACX-1vSViHIntdF6-bHAI0cl1HelY_X8rR4lf0P3W2Y8I5SyVMxG-ptggTHfWA0qrrU47RvuAydLE6Zex6L3/pubchart?oid=167590779" loading="lazy" />
  </a>
  <button hidden="" class="fig-description-button" aria-expanded="false" aria-controls="fig13-description" data-show-text="{{ show_description(13) }}" data-hide-text="{{ hide_description(13) }}">{{ show_description(13) }}</button>
  <div id="fig13-description" class="visually-hidden">p10パーセンタイルでは0ms、p25パーセンタイルでも同じ、p50パーセンタイルでは150ms、p75パーセンタイルでは1,460ms、p90パーセンタイルでは5,720msの保存が可能であることを示す棒グラフです。</div>
  <figcaption id="fig13-caption"><a href="#fig-13" class="anchor-link">図 13.</a> Lighthouseからの画像最適化によるページパフォーマンスの向上を予測。</figcaption>
</figure>
<h3 id="レスポンシブ画像"><a href="#レスポンシブ画像" class="anchor-link">レスポンシブ画像</a></h3>
<p>ページパフォーマンスを向上させるもう1つの軸として、レスポンシブ画像の適用があります。これは、画像の縮小によってディスプレイに表示されない余分なピクセルを減らすことで、画像のバイト数を減らすことに重点を置いた手法です。この章の最初の方でデスクトップの中央のウェブページでは、1MPの画像プレースホルダーが使用されているにもかかわらず、実際のピクセル量は2.1MP転送されていることを見ました。これは1xDPRテストだったので、1.1MPのピクセルがネットワーク経由で転送されましたが、表示されませんでした。このオーバーヘッドを減らすために、2つの技術のうちの1つを使用できます（3つの可能性もあります）。</p>
<ul>
  <li><strong>HTMLマークアップ</strong> - <code>srcset</code>要素と<code>sizes</code>要素を組み合わせて使用することで、ブラウザはビューポートの寸法とディスプレイの密度に基づいて最適な画像を選択できます。</li>
  <li><strong>クライアントヒント</strong> - これは、リサイズ可能な画像の選択をHTTPコンテントネゴシエーションに移行させます。</li>
  <li><strong>特典</strong>: JavaScriptライブラリーは、JavaScriptがブラウザーDOMを実行して検査し、コンテナーに基づいて正しい画像を挿入できるようになるまで画像のロードを遅らせます。</li>
</ul>
<h3 id="htmlマークアップの使用"><a href="#htmlマークアップの使用" class="anchor-link">HTMLマークアップの使用</a></h3>
<p>レスポンシブ画像を実装するもっとも一般的な方法は、<code>&lt;img srcset&gt;</code> または <code>&lt;source srcset&gt;</code>のいずれかを用いて代替画像のリストを作成することです。<code>srcset</code>がDPRに基づいている場合、ブラウザは追加情報なしでリストから正しい画像を選択できます。しかし、ほとんどの実装では、<code>srcset</code>のピクセルサイズに基づいて正しい画像を選択するため必要なレイアウト計算の方法をブラウザへ指示するため<code>&lt;img sizes&gt;</code>を利用しています。</p>
<figure id="fig-14">
  <a href="/static/images/2019/media/fig14_html_usage_of_responsive_images.png">
    <img src="/static/images/2019/media/fig14_html_usage_of_responsive_images.png" alt="図14. HTMLでレスポンシブ画像を使用しているページの割合。" aria-labelledby="fig14-caption" aria-describedby="fig14-description" width="600" height="371" data-width="600" data-height="371" data-seamless="" data-frameborder="0" data-scrolling="no" data-iframe="https://docs.google.com/spreadsheets/d/e/2PACX-1vSViHIntdF6-bHAI0cl1HelY_X8rR4lf0P3W2Y8I5SyVMxG-ptggTHfWA0qrrU47RvuAydLE6Zex6L3/pubchart?oid=582530039&amp;format=interactive" loading="lazy" />
  </a>
  <button hidden="" class="fig-description-button" aria-expanded="false" aria-controls="fig14-description" data-show-text="{{ show_description(14) }}" data-hide-text="{{ hide_description(14) }}">{{ show_description(14) }}</button>
  <div id="fig14-description" class="visually-hidden">18%の画像が「sizes」を使用しており、21%が「srcset」を使用しており、2%が「picture」を使用していることを示す棒グラフです。</div>
  <figcaption id="fig14-caption"><a href="#fig-14" class="anchor-link">図 14.</a> HTMLでレスポンシブ画像を使用しているページの割合。</figcaption>
</figure>
<p><a href="https://developer.mozilla.org/ja/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images#Art_direction">アートディレクション</a>のような高度なレスポンシブウェブデザイン（RWD）レイアウトによく使われていることを考えると、<code>&lt;picture&gt;</code>の使用率が著しく低いのは驚くべきことでありません。</p>
<h3 id="サイズの使用"><a href="#サイズの使用" class="anchor-link">サイズの使用</a></h3>
<p><code>srcset</code>の有用性は、通常は<code>sizes</code>メディアクエリの精度に依存します。<code>sizes</code>がないと、ブラウザは<code>&lt;img&gt;</code>タグが小さいコンポーネントではなくビューポート全体を埋め尽くすと仮定します。興味深いことに、ウェブ開発者が<code>&lt;img sizes&gt;</code>に採用している共通のパターンは5つあります。</p>
<ul>
  <li>
    <strong><code>&lt;img sizes="100vw"&gt;</code></strong> - これは画像がビューポートの幅を埋め尽くすことを示します（デフォルトでもあります）。
  </li>
  <li>
    <strong><code>&lt;img sizes="200px"&gt;</code></strong> - これは、DPRに基づいてブラウザを選択する際に便利です。
  </li>
  <li>
    <strong><code>&lt;img sizes="(max-width: 300px) 100vw, 300px"&gt;</code></strong> - これは2番目に人気のあるデザインパターンです。これはWordPressとおそらく他のいくつかのプラットフォームで自動生成されるものです。元の画像サイズ（この場合は300px）に基づいて自動生成されているように見えます。
  </li>
  <li>
    <strong><code>&lt;img sizes="(max-width: 767px) 89vw, (max-width: 1000px) 54vw, ..."&gt;</code></strong> - このパターンは、CSSレスポンシブレイアウトに合わせてカスタムビルドしたデザインパターンです。ブレークポイントごとに使用するサイズの計算が異なります。
  </li>
</ul>
<figure id="fig-15">
  <div class="table-wrap">
    <div class="table-wrap-container">
      <table>
        <thead>
          <tr>
            <th><code>&lt;img sizes&gt;</code></th>
            <th>頻度 (百万)</th>
            <th>%</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>(max-width: 300px) 100vw, 300px</td>
            <td>1.47</td>
            <td>5%</td>
          </tr>
          <tr>
            <td>(max-width: 150px) 100vw, 150px</td>
            <td>0.63</td>
            <td>2%</td>
          </tr>
          <tr>
            <td>(max-width: 100px) 100vw, 100px</td>
            <td>0.37</td>
            <td>1%</td>
          </tr>
          <tr>
            <td>(max-width: 400px) 100vw, 400px</td>
            <td>0.32</td>
            <td>1%</td>
          </tr>
          <tr>
            <td>(max-width: 80px) 100vw, 80px</td>
            <td>0.28</td>
            <td>1%</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <figcaption id="fig15-caption"><a href="#fig-15" class="anchor-link">図 15.</a> 最も人気のある<code>sizes</code>パターンを使用しているページの割合。</figcaption>
</figure>
<ul>
  <li>
    <p>
      <strong><code>&lt;img sizes="auto"&gt;</code></strong> - これはもっともよく使われている使い方ですが、実際には非標準であり、<code>lazy_sizes</code>JavaScriptライブラリの使用によるものです。これはクライアント側のコードを使って、ブラウザのためにより良い<code>sizes</code>の計算を注入します。これの欠点は、JavaScriptの読み込みとDOMの準備が完全に整っているかどうかに依存し、画像の読み込みが大幅に遅れることです。
    </p>
  </li>
</ul>
<figure id="fig-16">
  <a href="/static/images/2019/media/fig16_top_patterns_of_img_sizes.png">
    <img src="/static/images/2019/media/fig16_top_patterns_of_img_sizes.png" alt="図16. 'img sizes'のトップパターン。" aria-labelledby="fig16-caption" aria-describedby="fig16-description" width="600" height="371" data-width="600" data-height="371" data-seamless="" data-frameborder="0" data-scrolling="no" data-iframe="https://docs.google.com/spreadsheets/d/e/2PACX-1vSViHIntdF6-bHAI0cl1HelY_X8rR4lf0P3W2Y8I5SyVMxG-ptggTHfWA0qrrU47RvuAydLE6Zex6L3/pubchart?oid=663985412&amp;format=interactive" loading="lazy" />
  </a>
  <button hidden="" class="fig-description-button" aria-expanded="false" aria-controls="fig16-description" data-show-text="{{ show_description(16) }}" data-hide-text="{{ hide_description(16) }}">{{ show_description(16) }}</button>
  <div id="fig16-description" class="visually-hidden">1,130万枚の画像が「img sizes="(max-width: 300px) 100vw, 300px"」を使用しており、「auto」が160万枚、「img sizes="(max-width: 767px) 89vwなどなど"」が100万枚、「100vw」が23万枚、「300px」が13万枚であることを棒グラフで示しています。</div>
  <figcaption id="fig16-caption"><a href="#fig-16" class="anchor-link">図 16.</a> <code>&lt;img sizes&gt;</code>のトップパターン。</figcaption>
</figure>
<h3 id="クライアントヒント"><a href="#クライアントヒント" class="anchor-link">クライアントヒント</a></h3>
<p><a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/client-hints">クライアントヒント</a> は、コンテンツ制作者が画像のリサイズをHTTPコンテンツネゴシエーションに移すことを可能にします。この方法では、HTMLはマークアップを乱雑にするための追加の <code>&lt;img srcset&gt;</code> を必要とせず、代わりにサーバや <a href="https://cloudinary.com/blog/client_hints_and_responsive_images_what_changed_in_chrome_67">最適な画像を選択するための画像CDN</a> に依存できます。これによりHTMLの簡素化が可能になり、オリジンサーバが時間の経過とともに適応し、コンテンツ層とプレゼンテーション層を切り離すことが可能になります。</p>
<p>クライアントヒントを有効にするには、ウェブページでブラウザに追加のHTTPヘッダー<code>Accept-CH: DPR, Width, Viewport-Width</code>を使ってシグナルを送る必要があります。 <em>または</em> HTML<code>&lt;meta http-equiv="Accept-CH" content="DPR, Width, Viewport-Width"&gt;</code>を追加します。どちらか一方の手法の利便性は実装するチームに依存し、どちらも利便性のために提供されています。</p>
<figure id="fig-17">
  <a href="/static/images/2019/media/fig17_usage_of_accept-ch_http_v_html.png">
    <img src="/static/images/2019/media/fig17_usage_of_accept-ch_http_v_html.png" alt="Accept-CH の使用法: HTTP と HTML の比較。" aria-labelledby="fig17-caption" aria-describedby="fig17-description" width="600" height="371" data-width="600" data-height="371" data-seamless="" data-frameborder="0" data-scrolling="no" data-iframe="https://docs.google.com/spreadsheets/d/e/2PACX-1vSViHIntdF6-bHAI0cl1HelY_X8rR4lf0P3W2Y8I5SyVMxG-ptggTHfWA0qrrU47RvuAydLE6Zex6L3/pubchart?oid=284657706&amp;format=interactive" loading="lazy" />
  </a>
  <button hidden="" class="fig-description-button" aria-expanded="false" aria-controls="fig17-description" data-show-text="{{ show_description(17) }}" data-hide-text="{{ hide_description(17) }}">{{ show_description(17) }}</button>
  <div id="fig17-description" class="visually-hidden">71%が'meta http-equiv'を使用し、30% が'Accept-CH'HTTPヘッダーを使用し、1%が両方を使用していることを示す棒グラフです。</div>
  <figcaption id="fig17-caption"><a href="#fig-17" class="anchor-link">図 17.</a> <code>Accept-CH</code>ヘッダーと同等の<code>&lt;meta&gt;</code>タグの使用法。</figcaption>
</figure>
<p>HTMLでクライアントヒントを呼び出すために<code>&lt;meta&gt;</code>タグを使うのは、HTTPヘッダーに比べてはるかに一般的です。これは、ミドルボックスにHTTPヘッダーを追加するよりも、マークアップテンプレートを変更する方が便利であることを反映していると思われます。しかし、HTTPヘッダーの利用状況を見ると、50％以上が単一のSaaSプラットフォーム（Mercado）からのものです。</p>
<p>呼び出されたクライアントヒントのうち、大部分のページでは<code>DPR</code>,<code>ViewportWidth</code>,<code>Width</code>の3つのユースケースで使用されている。もちろん、<code>Width</code>のクライアントヒントでは、ブラウザがレイアウトに関する十分なコンテキストを持つために<code>&lt;img sizes&gt;</code>を使用する必要があります。</p>
<figure id="fig-18">
  <a href="/static/images/2019/media/fig18_enabled_client_hints.png">
    <img src="/static/images/2019/media/fig18_enabled_client_hints.png" alt="図18. 有効化されたクライアントヒント。" aria-labelledby="fig18-caption" aria-describedby="fig18-description" width="600" height="371" data-width="600" data-height="371" data-seamless="" data-frameborder="0" data-scrolling="no" data-iframe="https://docs.google.com/spreadsheets/d/e/2PACX-1vSViHIntdF6-bHAI0cl1HelY_X8rR4lf0P3W2Y8I5SyVMxG-ptggTHfWA0qrrU47RvuAydLE6Zex6L3/pubchart?oid=1878506264&amp;format=interactive" loading="lazy" />
  </a>
  <button hidden="" class="fig-description-button" aria-expanded="false" aria-controls="fig18-description" data-show-text="{{ show_description(18) }}" data-hide-text="{{ hide_description(18) }}">{{ show_description(18) }}</button>
  <div id="fig18-description" class="visually-hidden">ドーナツ型のパイチャートを見ると、クライアントヒントの26.1%が「dpr」を使用しており、24.3%が「viewport-width」を使用しており、19.7%が「width」を使用しており、6.7%が「save-data」を使用しており、6.1%が「device-memory」を使用しており、6.0%が「downnlink」を使用しており、5.6%が「rtt」を使用しており、5.6%が「ect」を使用していることを示しています。</div>
  <figcaption id="fig18-caption"><a href="#fig-18" class="anchor-link">図 18.</a> 有効化されたクライアントヒント。</figcaption>
</figure>
<p>ネットワーク関連のクライアントヒント<code>downlink</code>、<code>rtt</code>、<code>ect</code>はAndroid Chromeでのみ利用可能です。</p>
<h3 id="遅延ローディング"><a href="#遅延ローディング" class="anchor-link">遅延ローディング</a></h3>
<p>ウェブページのパフォーマンスを改善することは、部分的にはイリュージョンのゲームとして特徴付けることができます。このように遅延読み込み画像は、ユーザーがページをスクロールしたときにのみ画像やメディアコンテンツが読み込まれる、これらのイリュージョンの1つです。これにより、遅いネットワークでも知覚パフォーマンスが向上し、ユーザーが他の方法で表示されていないバイトをダウンロードする手間が省けます。</p>
<p>以前、<a href="#fig-5">図5</a>で、75パーセンタイルの画像コンテンツの量が、理論的には単一のデスクトップやモバイルのビューポートで表示できる量をはるかに超えていることを示しました。<a href="https://developers.google.com/web/tools/lighthouse/audits/offscreen-images">オフスクリーン画像</a>Lighthouseの監査は、この疑念を裏付けています。ウェブページの中央値では、折り目の下に27％の画像コンテンツがあります。これは、90パーセンタイルの割合で84％に増加しています。</p>
<figure id="fig-19">
  <a href="/static/images/2019/media/fig19_lighthouse_audit_offscreen.png">
    <img src="/static/images/2019/media/fig19_lighthouse_audit_offscreen.png" alt="図19. Lighthouse監査：オフスクリーン。" aria-labelledby="fig19-caption" aria-describedby="fig19-description" width="600" height="371" data-width="600" data-height="371" data-seamless="" data-frameborder="0" data-scrolling="no" data-iframe="https://docs.google.com/spreadsheets/d/e/2PACX-1vSViHIntdF6-bHAI0cl1HelY_X8rR4lf0P3W2Y8I5SyVMxG-ptggTHfWA0qrrU47RvuAydLE6Zex6L3/pubchart?oid=2123391693&amp;format=interactive" loading="lazy" />
  </a>
  <button hidden="" class="fig-description-button" aria-expanded="false" aria-controls="fig19-description" data-show-text="{{ show_description(19) }}" data-hide-text="{{ hide_description(19) }}">{{ show_description(19) }}</button>
  <div id="fig19-description" class="visually-hidden">P10パーセンタイルでは画像の0%が画面外、P25パーセンタイルでは2%が画面外、P50パーセンタイルでは27%が画面外、P75パーセンタイルでは64%が画面外、P90パーセンタイルでは 84%が画面外であることを示す棒グラフです。</div>
  <figcaption id="fig19-caption"><a href="#fig-19" class="anchor-link">図 19.</a> Lighthouse監査：オフスクリーン。</figcaption>
</figure>
<p>Lighthouseの監査では、質の高いプレースホルダーを使用するなど、油断できない状況がいくつもあるため、臭いを嗅ぎ分けてくれます。</p>
<p>遅延ローディングはIntersection Observers、Resize Observersの組み合わせを含め<a href="https://developers.google.com/web/fundamentals/performance/lazy-loading-guidance/images-and-video">実装可能</a> です、または<a href="https://github.com/aFarkas/lazysizes">lazySizes</a>、<a href="https://github.com/ApoorvSaxena/lozad.js">lozad</a>などのJavaScriptライブラリの使用などさまざまな方法で実装できます。</p>
<p>2019年8月、Chrome76では<code>&lt;img loading="lazy"&gt;</code>を使用したマークアップベースの遅延ローディングのサポートが開始されました。2019年のWeb Almanacに使用されたウェブサイトのスナップショットは2019年7月のデータを使用していますが、2,509以上のウェブサイトがすでにこの機能を利用していました。</p>
<h3 id="アクセシビリティ"><a href="#アクセシビリティ" class="anchor-link">アクセシビリティ</a></h3>
<p>画像アクセシビリティの中心にあるのは <code>alt</code> タグです。画像に <code>alt</code> タグが追加されると、このテキストは画像を見ることができない（障害のある、インターネット接続が悪いのいずれかの理由で）ユーザーに画像を説明するために使用されます。</p>
<p>データセットのHTMLファイルに含まれるすべての画像タグを検出できます。デスクトップでは1,300万個、モバイルでは1,500万個の画像タグのうち、91.6％の画像に<code>alt</code>タグが存在しています。一見すると、ウェブ上では画像のアクセシビリティは非常に良好な状態にあるように見えます。しかし、よく調べてみると、見通しはあまり良くありません。データセットに存在する<code>alt</code>タグの長さを調べると、<code>alt</code>タグの長さの中央値は6文字であることがわかります。これは空の<code>alt</code>タグ（<code>alt=""</code>のように見える）に対応する。6文字以上の長さの<code>alt</code>テキストを使用している画像は全体の39％にすぎない。実際の」<code>alt</code>テキストの中央値は31文字で、そのうち25文字が実際に画像を説明しています。</p>
<h2 id="動画"><a href="#動画" class="anchor-link">動画</a></h2>
<p>ウェブページで提供されるメディアは画像が主流ですが、ウェブ上でのコンテンツ配信では動画が大きな役割を果たし始めています。HTTP Archiveによると、デスクトップサイトの4.06％、モバイルサイトの2.99％が動画ファイルをセルフホスティングしていることがわかります。つまり、動画ファイルはYouTubeやFacebookのようなウェブサイトがホストしているわけではないということです。</p>
<h3 id="動画フォーマット"><a href="#動画フォーマット" class="anchor-link">動画フォーマット</a></h3>
<p>動画は、多くの異なるフォーマットやプレイヤーで配信できます。モバイルおよびデスクトップ向けの主要なフォーマットは、<code>.ts</code>（HLSストリーミングのセグメント）と<code>.mp4</code>(H264 MPEG) です。</p>
<figure id="fig-20">
  <a href="/static/images/2019/media/fig20_video_files_by_extension.png">
    <img src="/static/images/2019/media/fig20_video_files_by_extension.png" alt="図20. 拡張子別の動画ファイルの数" aria-labelledby="fig20-caption" aria-describedby="fig20-description" width="600" height="371" data-width="600" data-height="371" data-seamless="" data-frameborder="0" data-scrolling="no" data-iframe="https://docs.google.com/spreadsheets/d/e/2PACX-1vSViHIntdF6-bHAI0cl1HelY_X8rR4lf0P3W2Y8I5SyVMxG-ptggTHfWA0qrrU47RvuAydLE6Zex6L3/pubchart?oid=999894252&amp;format=interactive" loading="lazy" />
  </a>
  <button hidden="" class="fig-description-button" aria-expanded="false" aria-controls="fig20-description" data-show-text="{{ show_description(20) }}" data-hide-text="{{ hide_description(20) }}">{{ show_description(20) }}</button>
  <div id="fig20-description" class="visually-hidden">棒グラフは、デスクトップで「ts」が1,283,439件（モバイルで792,952件）、デスクトップで「mp4」が729,757件（モバイルで662,015件）、デスクトップで「webm」が38,591件（モバイルで32,417件）、デスクトップは「mov」が22,194件（モバイルは14,986件）、デスクトップは「m4s」が17,338件（モバイルは16,046件）、デスクトップは「m4v」が7,466件（モバイルは6,169件）となっています。</div>
  <figcaption id="fig20-caption"><a href="#fig-20" class="anchor-link">図 20.</a> 拡張子別の動画ファイルの数</figcaption>
</figure>
<p>他にも、<code>webm</code>、<code>mov</code>、<code>m4s</code>、<code>m4v</code>（MPEG-DASHストリーミングセグメント）などのフォーマットが見られます。ウェブ上のストリーミングの大部分はHLSであり、静的動画の主要なフォーマットは<code>mp4</code>であることが明らかです。</p>
<p>各フォーマットの動画サイズの中央値は以下の通りです。</p>
<figure id="fig-21">
  <a href="/static/images/2019/media/fig21_median_vidoe_file_size_by_extension.png">
    <img src="/static/images/2019/media/fig21_median_vidoe_file_size_by_extension.png" alt="図21. 動画の拡張子別のファイルサイズの中央値。" aria-labelledby="fig21-caption" aria-describedby="fig21-description" width="600" height="371" data-width="600" data-height="371" data-seamless="" data-frameborder="0" data-scrolling="no" data-iframe="https://docs.google.com/spreadsheets/d/e/2PACX-1vSViHIntdF6-bHAI0cl1HelY_X8rR4lf0P3W2Y8I5SyVMxG-ptggTHfWA0qrrU47RvuAydLE6Zex6L3/pubchart?oid=821311770&amp;format=interactive" loading="lazy" />
  </a>
  <button hidden="" class="fig-description-button" aria-expanded="false" aria-controls="fig21-description" data-show-text="{{ show_description(21) }}" data-hide-text="{{ hide_description(21) }}">{{ show_description(21) }}</button>
  <div id="fig21-description" class="visually-hidden">「ts」の平均ファイルサイズがデスクトップで335KB(モバイルで156KB)、「mp4」がデスクトップで175KB(モバイルで128KB)、「webm」がデスクトップで359KB(モバイルで192KB)、「mov」がデスクトップで128KB(モバイルで96KB)、「m4s」がデスクトップで324KB(モバイルで246KB)、「m4v」がデスクトップで383KB(モバイルで161KB)であることを示す棒グラフ。</div>
  <figcaption id="fig21-caption"><a href="#fig-21" class="anchor-link">図 21.</a> 動画の拡張子別のファイルサイズの中央値。</figcaption>
</figure>
<p>中央値はモバイルの方が小さくなっていますが、これはおそらくデスクトップで非常に大きな動画を持っているサイトがモバイル用へ無効化していたり、動画ストリームが小さい画面に小さいバージョンの動画を提供していたりすることを意味していると思われます。</p>
<h3 id="動画ファイルのサイズ"><a href="#動画ファイルのサイズ" class="anchor-link">動画ファイルのサイズ</a></h3>
<p>ウェブ上で動画を配信する場合、ほとんどの動画はHTML5動画プレイヤーで配信されます。HTML動画プレイヤーは、さまざまな目的で動画を配信するために非常にカスタマイズが可能です。たとえば、動画を自動再生するには、パラメーター<code>autoplay</code>と<code>muted</code>を追加します。<code>controls</code>属性は、ユーザーが動画を開始/停止したり、スキャンしたりすることを可能にします。HTTP Archiveの動画タグを解析することで、これらの属性の使用状況を確認できます。</p>
<figure id="fig-22">
  <a href="/static/images/2019/media/fig22_html_video_tag_attributes_usage.png">
    <img src="/static/images/2019/media/fig22_html_video_tag_attributes_usage.png" alt="図21. HTML 動画タグ属性の使用法。" aria-labelledby="fig21-caption" aria-describedby="fig21-description" width="600" height="371" data-width="600" data-height="371" data-seamless="" data-frameborder="0" data-scrolling="no" data-iframe="https://docs.google.com/spreadsheets/d/e/2PACX-1vSViHIntdF6-bHAI0cl1HelY_X8rR4lf0P3W2Y8I5SyVMxG-ptggTHfWA0qrrU47RvuAydLE6Zex6L3/pubchart?oid=593556050&amp;format=interactive" loading="lazy" />
  </a>
  <button hidden="" class="fig-description-button" aria-expanded="false" aria-controls="fig22-description" data-show-text="{{ show_description(22) }}" data-hide-text="{{ hide_description(22) }}">{{ show_description(22) }}</button>
  <div id="fig22-description" class="visually-hidden">デスクトップ用のバーチャート。'autoplay'は11.84%、'buffered'は0%、'controls'は12.05%、'crossorigin'は0.45%、'currenttime'は0.01%、'disablepictureinpicture'は0.01%、'disableremoteplayback'は0.01%、'duration'は0.05%、'height'は7.33%、'intrinsicsize'は0%、'loop'は14.57%、'muted'は13.92%、'playsinline'は6.49%、'poster'は8.98%、'preload'は11.62%、'src'は3.67%、'use-credentials'は0%、and 'width'は9%。そしてモバイルで'autoplay'は12.38%、'buffered'は0%、'controls'は13.88%、'crossorigin'は0.16%、'currenttime'は0.01%、disablepictureinpicture'は0.01%、'disableremoteplayback'は0.02%、'duration'は0.09%、'height'は6.54%、 intrinsicsize'は0%、'loop'は14.44%、'muted'は13.55%、'playsinline'は6.15%、'poster'は9.29%、'preload'は10.34%、'src'は4.13%、'use-credentials'は0%、'width'は9.03%である。</div>
  <figcaption id="fig22-caption"><a href="#fig-22" class="anchor-link">図 22.</a> HTML動画タグ属性の使用法。</figcaption>
</figure>
<p>もっとも一般的な属性は<code>autoplay</code>、<code>muted</code>、<code>loop</code>で、続いて<code>preload</code>タグ、そして<code>width</code>と<code>height</code>です。<code>loop</code>属性の使用は背景の動画や、動画をアニメーションGIFの代わりに、使用する場合に使用されるのでウェブサイトのホームページでよく使用されても不思議ではありません。</p>
<p>ほとんどの属性はデスクトップとモバイルで似たような使い方をしていますが、いくつかの属性には大きな違いがあります。モバイルとデスクトップの間でもっとも大きな違いがあるのは<code>width</code>と<code>height</code>の2つの属性で、モバイルではこれらの属性を使用しているサイトが4％少なくなっています。興味深いことに、モバイルでは<code>poster</code>属性（再生前に動画ウィンドウの上に画像を配置する）が少しだけ増加しています。</p>
<p>アクセシビリティの観点からは、<code>&lt;track&gt;</code>タグはキャプションや字幕を追加するために使用できます。HTTP Archiveには<code>&lt;track&gt;</code>タグの使用頻度に関するデータがありますが、調査したところ、データセットのほとんどのインスタンスはコメントアウトされているか、<code>404</code>エラーを返すアセットを指していました。多くのサイトでは、JavaScriptやHTMLのボイラプレートを使用しており、trackが使用されていない場合でもtrackを削除しないようになっているようです。</p>
<h3 id="動画プレイヤー"><a href="#動画プレイヤー" class="anchor-link">動画プレイヤー</a></h3>
<p>より高度な再生（および動画ストリームの再生）を行うには、HTML5ネイティブ動画プレイヤーは動作しません。再生に使用する一般的な動画ライブラリがいくつかあります。</p>
<figure id="fig-23">
  <a href="/static/images/2019/media/fig23_top_javascript_video_players.png">
    <img src="/static/images/2019/media/fig23_top_javascript_video_players.png" alt="図23. トップの JavaScript 動画プレイヤー" aria-labelledby="fig23-caption" aria-describedby="fig23-description" width="600" height="371" data-width="600" data-height="371" data-seamless="" data-frameborder="0" data-scrolling="no" data-iframe="https://docs.google.com/spreadsheets/d/e/2PACX-1vSViHIntdF6-bHAI0cl1HelY_X8rR4lf0P3W2Y8I5SyVMxG-ptggTHfWA0qrrU47RvuAydLE6Zex6L3/pubchart?oid=215677194&amp;format=interactive" loading="lazy" />
  </a>
  <button hidden="" class="fig-description-button" aria-expanded="false" aria-controls="fig23-description" data-show-text="{{ show_description(23) }}" data-hide-text="{{ hide_description(23) }}">{{ show_description(23) }}</button>
  <div id="fig23-description" class="visually-hidden">3,365のデスクトップサイト(3,400のモバイルサイト)、52,375のデスクトップサイト(40,925のモバイルサイト)、110,280のデスクトップサイト(96,945のモバイルサイト)、325のデスクトップサイト(275のモバイルサイト)の「shaka」、377,990のデスクトップサイト(391,330のモバイルサイト)の「video」を示す棒グラフです。</div>
  <figcaption id="fig23-caption"><a href="#fig-23" class="anchor-link">図 23.</a> トップの JavaScript 動画プレイヤー</figcaption>
</figure>
<p>もっとも人気があるのは（圧倒的に）video.jsで、JWPLayerとHLS.jsがそれに続いています。著者は、「video.js」という名前のファイルが、同じ動画再生ライブラリではない可能性があることを認めています。</p>
<h2 id="結論"><a href="#結論" class="anchor-link">結論</a></h2>
<p>ほぼすべてのウェブページではユーザー体験を向上させ、意味を生み出すために、画像や動画をある程度使用しています。これらのメディアファイルは大量のリソースを利用し、ウェブサイトのトン数の大部分を占めています（そして、それらがなくなることはありません！）代替フォーマット、遅延ロード、レスポンシブ画像、画像の最適化を利用することは、ウェブ上のメディアのサイズを小さくするために長い道のりを行くことができます。</p>
{% endblock %}
