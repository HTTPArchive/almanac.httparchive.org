{% extends "en/2019/base_chapter.html" %}

<!--{# IMPORTANT!

- `chapter.html` is a "template for templates" used by the `generate_chapters.js` script, hence the strange template syntax (eg, mixing ejs and jinja syntax)
- if you want to modify `chapter.html`, you must also:
  - translate the corresponding language-specific templates (eg `src/templates/<lang>/<year>/chapter.html`)
  - run the generation script to update each chapter template
- if you want to modify the chapter templates (eg `src/templates/<lang>/<year>/chapters/<chapter>.html`):
  - make changes to the markdown content directly (`src/content/<lang>/<year>/<chapter>.md`) because any changes to the chapter templates will be overwritten by the generation script
#}-->

{% set metadata = {"part_number":"II","chapter_number":1,"title":"JavaScript","authors":["housseindjirdeh"],"reviewers":["rviscomi","obto","paulcalvano","mathiasbynens"],"discuss":"1756"} %} {% block description %}{{ metadata.get('description',metadata.get('title') + ' chapter of the ' + year + ' Web Almanac') }}{% endblock %} {% block meta %}
<meta name="description" content="{{ self.description() }}" />
<meta property="og:title" content="{{ self.title() }}" />
<meta property="og:url" content="https://almanac.httparchive.org{{  url_for(request.endpoint, **get_view_args(lang=language.lang_code, year=year)) }}" />
<meta property="og:image" content="https://almanac.httparchive.org/static/images/{{ year }}/{{ get_chapter_image_dir(metadata) }}/hero_lg.jpg" />
<meta property="og:image:height" content="433" />
<meta property="og:image:width" content="866" />
<meta property="og:type" content="article" />
<meta property="og:description" content="{{ self.description() }}" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@HTTPArchive" />
<meta name="twitter:title" content="{{ self.title() }}" />
<meta name="twitter:image" content="https://almanac.httparchive.org/static/images/{{ year }}/{{ get_chapter_image_dir(metadata) }}/hero_sm.jpg" />
<meta name="twitter:image:alt" content="Chapter image for the {{ metadata.get('title') }} chapter of the {{ year }} Web Almanac" />
<meta name="twitter:description" content="{{ self.description() }}" />

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "mainEntityOfPage": {
    	  "@type": "WebPage",
    	  "@id": "https://almanac.httparchive.org{{  url_for(request.endpoint, **get_view_args(lang=language.lang_code, year=year)) }}"
    },
    "headline": "{{ metadata.get('title') }}",
    "image": {
    	  "@type": "ImageObject",
    	  "url": "https://almanac.httparchive.org/static/images/{{ year }}/{{ get_chapter_image_dir(metadata) }}/hero_lg.jpg",
    	  "height": 433,
    	  "width": 866
    },
    "publisher": {
    	  "@type": "Organization",
    	  "name": "HTTP Archive",
    	  "logo": {
    	      "@type": "ImageObject",
    	      "url": "https://almanac.httparchive.org/static/images/ha.png",
    	      "height": 160,
    	      "width": 320
    	  }
       },
    "author":
       {% for author in metadata.get('authors') %}{% if loop.length > 1 and loop.index == 1 %}[{% endif -%}
       {% set authordata = config.contributors[author] if author in config.contributors else None -%}
       {% if authordata -%}
    {
    	  "@type": "Person",
           "sameas": [
             "https://almanac.httparchive.org{{ url_for('contributors', year=year, lang=lang, _anchor=author) }}"
             {% if authordata.twitter %},"https://twitter.com/{{ authordata.twitter }}"{% endif %}
             {% if authordata.github %},"https://github.com/{{ authordata.github }}"{% endif %}
             ],
    	  "name": "{{ authordata.name if authordata.name else author }}"
       }{% if loop.index < loop.length %},{% endif %}
       {%- endif %}{% if loop.index > 1 and loop.index == loop.length %}]{% endif -%}
       {% endfor %},
       "description": "{{ self.description() }}",
       "datePublished": "{{ metadata.get('published','2019-11-04') + 'T12:00:00+00:00:00' }}",
       "dateModified": "{{ metadata.get('last_updated','2019-11-04') + 'T12:00:00+00:00:00' }}"
  }
</script>
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "{{ year }} Home ({{ language }})",
        "item": "https://almanac.httparchive.org{{  url_for('home', year=year, lang=lang) }}"
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": "{{ metadata.get('title') }}",
        "item": "https://almanac.httparchive.org{{  url_for(request.endpoint, **get_view_args(lang=language.lang_code, year=year)) }}"
      }
    ]
  }
</script>
{% endblock %} {% block main %}
<article id="chapter" class="main">
  <nav class="index">
    <div class="index-box floating-card">
      <h2 class="header">Index</h2>
      <ul>
        <li>
          <a href="#chapter-1-javascript">Chapter 1: JavaScript</a>
        </li>

        <li>
          <a href="#how-much-javascript-do-we-use">How much JavaScript do we use?</a>

          <ul>
            <li>
              <a href="#processing-time">Processing time</a>
            </li>

            <li>
              <a href="#number-of-requests">Number of requests</a>
            </li>

            <li>
              <a href="#first-party-vs-third-party">First-party vs. third-party</a>
            </li>
          </ul>
        </li>

        <li>
          <a href="#resource-compression">Resource compression</a>
        </li>

        <li>
          <a href="#open-source-libraries-and-frameworks">Open source libraries and frameworks</a>

          <ul>
            <li>
              <a href="#frameworks-and-ui-libraries">Frameworks and UI libraries</a>
            </li>
          </ul>
        </li>

        <li>
          <a href="#differential-loading">Differential loading</a>
        </li>

        <li>
          <a href="#preload-and-prefetch">Preload and prefetch</a>
        </li>

        <li>
          <a href="#newer-apis">Newer APIs</a>
        </li>

        <li>
          <a href="#source-maps">Source maps</a>
        </li>

        <li>
          <a href="#conclusion">Conclusion</a>
        </li>
      </ul>
    </div>
  </nav>

  <section class="content">
    <section class="body">
      <div class="subtitle">
        Part {{ metadata.get('part_number') }} Chapter {{ metadata.get('chapter_number') }}
      </div>
      <h1 class="title">
        {{ metadata.get('title') }}
      </h1>
      <img src="/static/images/{{ year }}/{{ get_chapter_image_dir(metadata) }}/hero_lg.jpg" class="content-banner" />
      {{ render_byline() }}
      <h1 id="chapter-1-javascript">Chapter 1: JavaScript</h1>
      <p>JavaScript is a scripting language that makes it possible to build interactive and complex experiences on the web. This includes responding to user interactions, updating dynamic content on a page and so forth. Anything involving how a web page should behave when an event occurs is what JavaScript is used for.</p>
      <p>The language specification itself, along with many community-built libraries and frameworks used by developers around the world, has changed and evolved ever since the language was created in 1995. JavaScript implementations and interpreters have also continued to progress, making the language usable in many environments, not only web browsers.</p>
      <p>The <a href="https://httparchive.org/">HTTP Archive</a> crawls <a href="https://httparchive.org/reports/state-of-the-web#numUrls">millions of URLs</a> every month and runs them through a private instance of <a href="https://webpagetest.org/">WebPageTest</a> to store key information of every page (see <a href="./methodology">methodology</a>). In the context of JavaScript, HTTP Archive provides extensive information on the usage of the language for the entire web. This chapter consolidates and analyzes many of these trends.</p>
      <h1 id="how-much-javascript-do-we-use">How much JavaScript do we use?</h1>
      <p>
        JavaScript is the most costly resource we send to browsers, having to be downloaded, parsed, compiled and then finally executed. Although browsers have significantly decreased the time it takes to parse and compile scripts,
        <a href="https://v8.dev/blog/cost-of-javascript-2019">download and execution have become the most expensive stages</a>
        when JavaScript is processed by a web page.
      </p>
      <p>Sending smaller JavaScript bundles to the browser is the best way to reduce download times, and in turn improve page performance. <strong>But how much JavaScript do we really use?</strong></p>
      <p>Here's a chart showing the amount of bytes shipped for different percentiles:</p>
      <p><code>&lt;insert graphic of metric 01_01a&gt;</code></p>
      <p><strong>373.46 kB</strong> of JavaScript is shipped at the 50th percentile, or median. In other words, 50% of all sites ship over this much JavaScript to their users.</p>
      <p>Looking at these numbers, it's only natural to wonder if this is too much JavaScript. However in terms of page performance, the impact entirely depends on network connections and devices used. That brings us to our next question, <strong>how much JavaScript do we ship when we compare mobile and desktop clients</strong>?</p>
      <p><code>&lt;insert graphic of metric 01_01b&gt;</code></p>
      <p>At every percentile, we're sending slightly more JavaScript on desktop devices than we are on mobile.</p>
      <h2 id="processing-time">Processing time</h2>
      <p>After being parsed and compiled, JavaScript fetched by the browser needs to processed, or executed, before it can be utilized. Devices vary, and their computing power can significantly affect how fast JavaScript can be processed on a page. <strong>What are the current processing times on the web?</strong></p>
      <p>We can get an idea by analyzing main thread processing times for V8 at different percentiles:</p>
      <p><code>&lt;insert graphic of metric 01_07&gt;</code></p>
      <p>At every percentile, processing times are longer for mobile web pages than on desktop. The median total main thread time on desktop is <strong>849 ms</strong>, while mobile is at a larger number - <strong>2436ms.</strong></p>
      <p>Although this data shows how much longer it can take for a mobile device to process JavaScript than a more powerful desktop machine, mobile devices also vary in terms of computing power. The following chart shows how processing times on a single web page can vary significantly depending on the mobile device class.</p>
      <p><img src="/static/images/2019/01_JavaScript/js-processing-reddit.png" alt="JavaScript processing times for Reddit.com" /></p>
      <p>
        <em>From <a href="https://v8.dev/blog/cost-of-javascript-2019">"The cost of JavaScript in 2019" </a></em>
      </p>
      <h2 id="number-of-requests">Number of requests</h2>
      <p>One avenue worth exploring when trying to analyze the amount of JavaScript used by web pages is the number of requests shipped. With <a href="https://developers.google.com/web/fundamentals/performance/http2">HTTP/2</a>, sending multiple smaller chunks can improve page load over sending a larger, monolithic bundle. If we also break it down by device client, <strong>how many requests are being fetched?</strong></p>
      <p><code>&lt;insert graphic of metric 01_03&gt;</code></p>
      <p>At the median, <strong>19</strong> requests are sent for desktop and <strong>18</strong> for mobile.</p>
      <h2 id="first-party-vs-third-party">First-party vs. third-party</h2>
      <p>Of the results analyzed so far, the entire size and number of requests were being considered. In a majority of websites however, a significant portion of the JavaScript code fetched and used comes from third-party sources.</p>
      <p>Third-party JavaScript can come from any external, third-party source. Ads, analytics and social media embeds are all common use-cases for fetching third-party scripts. So naturally, this brings us to our next question: <strong>how many requests sent are third-party instead of first-party?</strong></p>
      <p><code>&lt;insert graphics of metric 01_04&gt;</code></p>
      <p>For both mobile and desktop clients, more third-party requests are sent than first-party at every percentile. If this seems surprising, let's find out** how much actual code shipped comes from third-party vendors.**</p>
      <p><code>&lt;insert graphics of metric 01_02b&gt;</code></p>
      <p>At the median, <strong>89%</strong> more third-party code is used than first-party code authored by the developer for both mobile and desktop**. **This clearly shows that third-party code can be one of the biggest contributors to bloat.</p>
      <h1 id="resource-compression">Resource compression</h1>
      <p>In the context of browser-server interactions, <strong>resource compression</strong> refers to code that has been modified using a data compression algorithm. Resources can be compressed statically ahead of time or on-the-fly as they are requested by the browser, and for either approach the transferred resource size is significantly reduced which improves page performance.</p>
      <p>There are multiple text-compression algorithms, but only two are mostly used for the compression (and decompression) of HTTP network requests:</p>
      <ul>
        <li><a href="https://www.gzip.org/">Gzip</a> (gzip): The most widely used compression format for server and client interactions</li>
        <li><a href="https://github.com/google/brotli">Brotli</a> (br): A newer compression algorithm aiming to further improve compression ratios. <a href="https://caniuse.com/#feat=brotli">90% of browsers</a> support Brotli encoding.</li>
      </ul>
      <p>Compressed scripts will always need to be uncompressed by the browser once transferred. This means its content remains the same and execution times are not optimized whatsoever. Resource compression, however, will always improve download times which also is one of the most expensive stages of JavaScript processing. Ensuring JavaScript files are compressed correctly can be one of the most significant factors in improving site performance.</p>
      <p><strong>How many sites are compressing their JavaScript resources</strong>?</p>
      <p><code>&lt;insert graphics of metric 01_05 and 01_06&gt;</code></p>
      <p>The majority of sites are compressing their JavaScript resources. Gzip encoding is used on <strong>~64-67%</strong> of sites and Brotli on <strong>~14%</strong>. Compression ratios are similar for both desktop and mobile.</p>
      <p>For a deeper analysis on compression, refer to the <a href="./compression">"Compression"</a> chapter.</p>
      <h1 id="open-source-libraries-and-frameworks">Open source libraries and frameworks</h1>
      <p>Open source code, or code with a permissive license that can be accessed, viewed and modified by anyone. From tiny libraries to entire browsers, such as <a href="https://www.chromium.org/Home">Chromium</a> and <a href="https://www.openhub.net/p/firefox">Firefox</a>, open source code plays a crucial role in the world of web development. In the context of JavaScript, developers rely on open source tooling to include all types of functionality into their web page. Regardless of whether a developer decides to use a small utility library or a massive framework that dictates the architecture of their entire application, relying on open-source packages cam make feature development easier and faster.</p>
      <p><strong>Which JavaScript open-source libraries are used the most?</strong></p>
      <p><code>&lt;insert graphics of metric 01_08&gt;</code></p>
      <p><a href="https://jquery.com/">jQuery</a>, the most popular JavaScript library ever created, is used in <strong>85.03%</strong> of desktop pages and <strong>83.46%</strong> of mobile pages. The advent of many Browser APIs and methods, such as <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">Fetch</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelector">querySelector</a>, standardized much of the functionality provided by the library into a native form. Although the popularity of jQuery may seem to be declining, why is it still used in the vast majority of the web?</p>
      <p>There are a number of possible reasons:</p>
      <ul>
        <li><a href="https://wordpress.org/">WordPress</a>, which is used in more than 30% of sites, includes jQuery by default</li>
        <li>Switching from jQuery to a newer client-side library can take time depending on how large an application is, and many sites may consist of jQuery in addition to newer client-side libraries</li>
      </ul>
      <p>Other top used JavaScript libraries include jQuery variants (jQuery migrate, jQuery UI), <a href="https://modernizr.com/">Modernizr</a>, <a href="https://momentjs.com/">Moment.js</a>, <a href="https://underscorejs.org/">Underscore.js</a> and so on.</p>
      <h2 id="frameworks-and-ui-libraries">Frameworks and UI libraries</h2>
      <p>In the past number of years, the JavaScript ecosystem has seen a rise in open-source libraries and frameworks to make building <strong>single-page applications</strong> (SPAs) easier. A single-page application is characterized as a web page that loads a single HTML page and uses JavaScript to modify the page on user interaction instead of fetching new pages from the server. Although this remains to be the main premise of single-page applications, different server-rendering approaches can still be used to improve the experience of such sites.</p>
      <p><strong>How many sites use these types of frameworks?</strong></p>
      <p><code>&lt;insert graphics of metric 01_10_05&gt;</code></p>
      <p>Only a subset of popular frameworks are being analyzed here, but it's important to note that all of them either follow one of these two approaches:</p>
      <ul>
        <li>A <a href="https://developer.chrome.com/apps/app_frameworks">model-view-controller</a> (or model-view-viewmodel) architecture</li>
        <li>A component-based architecture</li>
      </ul>
      <p>Although there has been a shift towards a component-based model, many older frameworks that follow the MVC paradigm (<a href="https://angularjs.org/">AngularJS</a>, <a href="https://backbonejs.org/">Backbone.js</a>, <a href="https://emberjs.com/">Ember</a>) are still being used in thousands of pages. However, <a href="https://reactjs.org/">React</a>, <a href="https://vuejs.org/">Vue</a> and <a href="https://angular.io/">Angular</a> are the most popular component-based frameworks (<a href="https://github.com/angular/zone.js">Zone.js</a> is a package that is now part of Angular core).</p>
      <p>Although this analysis is interesting, it's important to keep in mind that these results rely on a third-party detection library - <a href="https://www.wappalyzer.com">Wappalyzer</a>. All these usage numbers depend on the accuracy of each <a href="https://github.com/AliasIO/Wappalyzer/blob/master/src/apps.json">detection mechanism</a> in place.</p>
      <h1 id="differential-loading">Differential loading</h1>
      <p><a href="https://v8.dev/features/modules">JavaScript modules</a>, or ES modules, are supported in <a href="https://caniuse.com/#feat=es6-module">all major browsers</a>. Modules provide the capability to create scripts that can import and export from other modules. This allows anyone to build their applications architected in a module pattern, importing and exporting wherever necessary, without relying on third-party module loaders.</p>
      <p>To declare a script as a module, the script tag must get the <code>type="module"</code>:</p>
      <pre><code class="html language-html">&lt;script type="module" src="main.mjs"&gt;&lt;/script&gt;</code></pre>
      <p>
        <strong>How many sites use <code>type="module"</code> for scripts on their page?</strong>
      </p>
      <p><code>&lt;insert graphic of metric 01_12&gt;</code></p>
      <p>Browser-level support for modules is still relatively new, and the numbers here show that very few sites currently use <code>type="module"</code> for their scripts. Many sites are still relying on module loaders (~<strong>2.37%</strong> of all desktop sites use <a href="https://github.com/requirejs/requirejs">RequireJS</a> for example) and bundlers (<a href="https://webpack.js.org/">webpack</a> for example) to define modules within their codebase.</p>
      <p>If native modules are used, it's important to ensure that an appropriate fallback script is used for browsers that do not yet support modules. This can be done by including an additional script with a <code>nomodule</code> attribute,</p>
      <pre><code class="html language-html">&lt;script nomodule src="fallback.js"&gt;&lt;/script&gt;</code></pre>
      <p>When used together, browsers that support modules will completely ignore any scripts containing the <code>nomodule</code> attribute. On the other hand, browsers that do not yet support modules will not download any scripts with <code>type="module"</code>. Since they do not recognize <code>nomodule</code> either, they will download scripts with the attribute normally. Using this approach can allow developers to <a href="https://web.dev/serve-modern-code-to-modern-browsers/">send modern code to modern browsers for faster page loads</a>.</p>
      <p>
        So, <strong>how many sites use <code>nomodule</code> for scripts on their page?</strong>
      </p>
      <p><code>&lt;insert graphic of metric 01_13&gt;</code></p>
      <p>Similarly, very few sites (<strong>~0.5% - 0.8%</strong>) use the <code>nomodule</code> attribute for any scripts.</p>
      <h1 id="preload-and-prefetch">Preload and prefetch</h1>
      <p><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Preloading_content">Preload</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Link_prefetching_FAQ">prefetch</a> are directives which enable you to aid the browser in determining what resources need to be downloaded.</p>
      <ul>
        <li>Preloading a resource with <code>&lt;link rel="preload"&gt;</code>tells the browser to download this resource as soon as possible. This is especially helpful for critical resources which are discovered late in the page loading process (e.g., javascript located at the bottom of your HTML) and are otherwise downloaded last.</li>
        <li>Using <code>&lt;link rel="prefetch"&gt;</code> tells the browser to take advantage of any idle time it has to fetch these resources needed for future navigations</li>
      </ul>
      <p><strong>So, how many sites use preload and prefetch directives?</strong></p>
      <p><code>&lt;insert graphic of metric 01_14&gt;</code></p>
      <p>For all sites measured in HTTP Archive, <strong>14.33%</strong> of desktop sites and <strong>14.84%</strong> of mobile sites use <code>&lt;link rel="preload"&gt;</code>for scripts on their page.</p>
      <p>For prefetch:</p>
      <p><code>&lt;insert graphic of metric 01_16&gt;</code></p>
      <p>For both mobile and desktop, <strong>0.08% (~0.1%)</strong> of pages leverage prefetch for any of their scripts.</p>
      <h1 id="newer-apis">Newer APIs</h1>
      <p>JavaScript continues to evolve as a language. A new version of the language standard itself, known as ECMAScript, is released every year with new APIs and features passing proposal stages to become a part of the language itself.</p>
      <p>With HTTP Archive, we can take a look at any newer API that is supported (or is about to be) and see how widespread its usage is. These APIs may already be used in browsers that support them <em>or</em> with an accompanying polyfill to make sure they still work for every user.</p>
      <p><strong>How many sites use the following APIs?</strong></p>
      <ul>
        <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Atomics">Atomics</a></li>
        <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl">Intl</a></li>
        <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxy</a></li>
        <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer">SharedArrayBuffer</a></li>
        <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap">WeakMap</a></li>
        <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakSet">WeakSet</a></li>
      </ul>
      <p><code>&lt;insert graphic of metric 01_18&gt;</code></p>
      <p>Atomics (<strong>0.38%</strong>) and SharedArrayBuffer (<strong>0.2%</strong>) are barely visible on this chart since they are used on such few pages. Each of the other APIs here</p>
      <p>
        It is important to note that the numbers here are approximations and they do not leverage
        <a href="https://chromium.googlesource.com/chromium/src.git/+/master/docs/use_counter_wiki.md">UseCounter</a>
        to measure feature usage.
      </p>
      <h1 id="source-maps">Source maps</h1>
      <p>In many build systems, JavaScript files undergo minification to minimize its size and transpilation for newer language features that are not yet supported in many browsers. Moreover, language supersets like <a href="https://www.typescriptlang.org/">TypeScript</a> compile to an output that can look noticeably different from the original source code. For all these reasons, the final code served to the browser can unreadable and hard to decipher.</p>
      <p>A <strong>source map</strong> is an additional file accompanying a JavaScript file that allows a browser to map the final output to its original source. This can make debugging and analyzing production bundles much simpler.</p>
      <p>Although useful, there are a number of reasons why many sites may not want to include source maps in their final production site, such as choosing not to expose complete source code to the public. <strong>So how many sites actually include sourcemaps?</strong></p>
      <p><code>&lt;insert graphic of metric 01_25&gt;</code></p>
      <p>For both desktop and mobile pages, the results are about the same. <strong>17-18%</strong> include a source map for at least one script on the page (detected as a first-party script with <code>sourceMappingURL</code>).</p>
      <h1 id="conclusion">Conclusion</h1>
      <p>Every year, the JavaScript ecosystem continues to change and evolve. Newer APIs, improved browser engines, and fresh libraries and frameworks are all things we can expect to happen indefinitely. HTTP Archive provides us with valuable insight on how sites in the wild use the language.</p>
      <p>Without JavaScript, the web would not be where it is today, and all the data gathered for this article only proves this.</p>
    </section>
    {{ render_actions() }}
    <section class="authors">
      {{ render_authors() }}
    </section>

    <nav id="chapter-navigation">
      {{ render_prevnext() }}
    </nav>
  </section>
</article>
{% endblock %}
