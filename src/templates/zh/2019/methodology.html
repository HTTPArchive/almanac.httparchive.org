{% extends "base/2019/methodology.html" %}

{% block title %}方法论 | The Web Almanac by HTTP Archive{% endblock %}

{% block description %}描述 2019 Web Almanac 是如何构成的: 使用的数据集和工具，以及项目是如何运行的。{% endblock %}

{% block twitter_image_alt %}{{ year }} Web Almanac methodology{% endblock %}

{% block date_published %}2019-11-04T12:00:00.000Z{% endblock %}
{% block date_modified %}2020-06-21T00:00:00.000Z{% endblock %}

{% block index %}
      <ul>
        <li><a href="#overview">概述</a></li>
        <li><a href="#dataset">关于数据集</a>
          <ul>
            <li><a href="#websites">网站</a></li>
            <li><a href="#metrics">指标</a></li>
          </ul>
        </li>
        <li><a href="#tools">工具</a>
          <ul>
            <li><a href="#webpagetest">WebPageTest</a></li>
            <li><a href="#lighthouse">Lighthouse</a></li>
            <li><a href="#wappalyzer">Wappalyzer</a></li>
            <li><a href="#chrome-ux-report">Chrome UX Report</a></li>
            <li><a href="#third-party-web">Third Party Web</a></li>
            <li><a href="#rework-css">Rework CSS</a></li>
          </ul>
        </li>
        <li><a href="#process">分析过程</a>
          <ul>
            <li><a href="#brainstorming">头脑风暴</a></li>
            <li><a href="#analysis">分析</a></li>
            <li><a href="#interpretation">诠释</a></li>
          </ul>
        </li>
        <li><a href="#looking-ahead">展望未来</a></li>
      </ul>
{% endblock %}

{% block main_content %}
    <section>
      <!-- Show large image for large screens and high density screens and use webp when supported -->
      <picture>
          <source media="(min-width: 327px)" type="image/webp" srcset="/static/images/methodology-banner.webp" />
          <source media="(min-width: 327px)" type="image/jpeg" srcset="/static/images/methodology-banner.png" />
          <source type="image/webp" srcset="/static/images/methodology-banner.webp 2x" />
          <source type="image/jpeg" srcset="/static/images/methodology-banner.png 2x" />
          <source type="image/webp" srcset="/static/images/methodology-banner-sm.webp" />
          <source type="image/jpeg" srcset="/static/images/methodology-banner-sm.png" />
          <img src="/static/images/methodology-banner.png" class="content-banner" alt="" width="1200" height="984" loading="eager" />
        </picture>
        <h2 id="overview"><a href="#overview" class="anchor-link">Overview</a></h2>

        <p>
          Web Almanac 是一个由 <a href="https://httparchive.org">HTTP Archive</a>组织的项目. HTTP Archive 于2010年由Steve Souders创立，其任务是跟踪web是如何构建的。它按月评估数以百万计的网页，并使它的TB级别的元数据可供<a href="https://httparchive.org/faq#how-do-i-use-bigquery-to-write-custom-queries-over-the-data">BigQuery</a>分析。了解更多 <a href="https://httparchive.org/about">HTTP Archive</a>.
        </p>

        <p>
          Web Almanac 的任务是让主题专家提供情境化的见解，从而使Web社区更容易访问HTTP Archive的数据仓库。你可以把它看作为成一个关于web状态的年度知识库，2019是它的第一版。
        </p>

        <p>
          2019年版的网络年鉴Webqing Almanac由四大支柱组成:内容、体验、发布和分发。书面报告的每一部分都是一个支柱，由探究其不同方面的章节组成。例如，第二部分表示用户体验，并包括性能、安全性、可访问性、SEO、PWA和移动Web章节。
        </p>
    </section>

    <section>
        <h2 id="dataset"><a href="#dataset" class="anchor-link">About the dataset</a></h2>

        <p>
          HTTP Archive 数据集每月持续更新新的数据。对于2019年版的Web Almanac，除非本章另有说明，否则所有的指标都来自于2019年7月的抓取。这些结果<a href="https://github.com/HTTPArchive/httparchive.org/blob/master/docs/gettingstarted_bigquery.md">可以用 <code>2019_07_01</code>为前缀在BigQuery公开的查询</a>
        </p>

        <p>
          Web Almanac中列出的所有指标都可以通过BigQuery上的数据集公开重现。您可以在我们的<a href="https://github.com/HTTPArchive/almanac.httparchive.org/tree/main/sql/2019">GitHub 仓库</a>浏览我们的所有章节使用的查询 .
        </p>

        <p class="note">
          请注意，其中一些查询相当大，如果你自己运行可能比较 <a href="https://cloud.google.com/bigquery/pricing">昂贵</a> , 因为BigQuery是按TB收费. 为了帮助控制你的开支, 请看 Tim Kadlec的文章 <a href="https://timkadlec.com/remembers/2019-12-10-using-bigquery-without-breaking-the-bank/">在不破产的情况下来使用BigQuery</a>.
        </p>

        <p>
          例如，要了解每个桌面和移动页面的JavaScript字节数的中位数，请参阅 <a href="https://github.com/HTTPArchive/almanac.httparchive.org/blob/main/sql/2019/01_JavaScript/01_01b.sql">01_01b.sql</a>:
        </p>

        <div class="code-block floating-card">
          <pre><code><span class="code-comment">#standardSQL
# 01_01b: Distribution of JS bytes by client</span>
<span class="code-keyword">SELECT</span>
  percentile,
  _TABLE_SUFFIX <span class="code-keyword">AS</span> client,
  <span class="code-function">APPROX_QUANTILES</span>(<span class="code-function">ROUND</span>(bytesJs <span class="code-keyword">/</span> <span class="code-number">1024</span>, <span class="code-number">2</span>), <span class="code-number">1000</span>)[<span class="code-function">OFFSET</span>(percentile <span class="code-keyword">*</span> <span class="code-number">10</span>)] <span class="code-keyword">AS</span> js_kbytes
<span class="code-keyword">FROM</span>
  <span class="code-string">`httparchive.summary_pages.2019_07_01_*`</span>,
  <span class="code-function">UNNEST</span>([<span class="code-number">10</span>, <span class="code-number">25</span>, <span class="code-number">50</span>, <span class="code-number">75</span>, <span class="code-number">90</span>]) <span class="code-keyword">AS</span> percentile
<span class="code-keyword">GROUP BY</span>
  percentile,
  client
<span class="code-keyword">ORDER BY</span>
  percentile,
  client</code></pre>
        </div>

        <p>
          每个指标的结果都可以在章节对应的电子表格中公开查看，例如<a href="https://docs.google.com/spreadsheets/d/1kBTglETN_V9UjKqK_EFmFjRexJnQOmLLr-I2Tkotvic/edit?usp=sharing">JavaScript 结果</a>.
        </p>
    </section>

    <section>
        <h3 id="websites"><a href="#websites" class="anchor-link">Websites</a></h3>

        <p>
          数据集中有 5,790,700 个网站。 其中，移动网站5,297,442 个，桌面网站4,371,973个。大多数网站都包括在移动和桌面子集中。
        </p>

        <p>
          HTTP Archive 从 <a href="#chrome-ux-report">Chrome用户体验 报告</a>中获取其网站的URL。Chrome用户体验报告是谷歌的公共数据集，汇集了数百万Chrome用户活跃访问的网站的用户体验。这给了我们一个最新的网站列表，并反映了真实的web使用情况。Chrome用户体验报告数据集包括一个因子系数维度，我们使用它来获取桌面或移动用户访问的所有网站。
        </p>

        <p>
          Web Almanac使用的2019年七月的HTTP Archive爬取，是利用了最新可用的Chrome用户体验报告版本 2019 5月 (201905) 作为它的网站列表。 该数据集于2019年6月11日发布，收集了Chrome用户在5月份访问的网站。
        </p>

        <p>
          由于资源限制， HTTP Archive 只能对每个网站测试一个在Chrome UX报告之中的页面。为了兼顾这一点，只包括主页。请注意，这将引入一些偏见的结果，因为一个主页不一定代表整个网站。
        </p>

        <p>
          HTTP Archive 也被认为是一个实验室测试工具，这意味着它从数据中心测试网站，而不是从真实的用户体验收集数据。因此，所有网站主页都是在一个处于登出的空缓存状态进行测试的。
        </p>
    </section>

    <section>
      <h3 id="metrics"><a href="#metrics" class="anchor-link">Metrics</a></h3>

      <p>
        HTTP Archive 收集关于如何构建web的指标。它包括一些基本指标，如每个页面的字节数、页面是否通过HTTPS加载，以及单个请求和响应头。这些指标中的大多数是由<a href="#webpagetest">WebPageTest</a>提供, 它作为每个网站的测试运行工具。
      </p>

      <p>
        其他测试工具用于提供关于页面的更高级的指标。 例如， <a href="#lighthouse">Lighthouse</a> 被用来对页面进行审计，以分析它在可访问性和SEO等方面的质量。下面的 <a href="#tools">工具</a>小节将更详细地介绍这些工具。
      </p>

      <p>
        为了解决实验室数据集的一些固有限制，Web Almanac 还利用了 <a href="#chrome-ux-report">Chrome UX Report</a> 来度量用户体验，特别是在Web性能方面。
      </p>

      <p>
       有些指标是完全无法达到的。例如，我们不一定有能力检测用于创建网站的工具。如果一个网站是使用create-react-app构建的，我们可以看出它使用的是React框架，但不一定是使用了特定的构建工具。除非这些工具在网站代码中留下可探测的指纹，否则我们无法测量它们的使用情况。
      </p>

      <p>
        其他的指标不一定是不可能度量的，但是是具有挑战性的或者不可靠的。例如，web设计的某些方面本质上是可视化的，可能很难量化，比如页面是否有插入式模态对话框。
      </p>
    </section>

    <section>
      <h2 id="tools"><a href="#tools" class="anchor-link">Tools</a></h2>

      <p>
        Web Almanac 是在以下开源工具的帮助下实现的。
      </p>
    </section>

    <section>
      <h3 id="webpagetest"><a href="#webpagetest" class="anchor-link">WebPageTest</a></h3>

      <p>
        <a href="https://www.webpagetest.org/">WebPageTest</a> is a prominent web performance testing tool and the backbone of HTTP Archive. We use a <a href="https://github.com/WPO-Foundation/webpagetest-docs/blob/master/user/Private%20Instances/README.md">private instance</a> of WebPageTest with private test agents, which are the actual browsers that test each web page. Desktop and mobile websites are tested under different configurations:
      </p>
      <div class="table-wrap"><div class="table-wrap-container">
      <table>
        <thead>
          <tr>
              <th>Config</th>
              <th>Desktop</th>
              <th>Mobile</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Device</td>
            <td>Linux VM</td>
            <td>Emulated Moto G4</td>
          </tr>

          <tr>
            <td>User Agent</td>
            <td>
              Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36 PTST/190704.170731
            </td>
            <td>
              Mozilla/5.0 (Linux; Android 6.0.1; Moto G (4) Build/MPJ24.139-64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.146 Mobile Safari/537.36 PTST/190628.140653
            </td>
          </tr>

          <tr>
            <td>Location</td>
            <td>
              Redwood City, California, USA<br>
              The Dalles, Oregon, USA
            </td>
            <td>
              Redwood City, California, USA<br>
              The Dalles, Oregon, USA
            </td>
          </tr>

          <tr>
            <td>Connection</td>
            <td>Cable (5/1 Mbps 28ms RTT)</td>
            <td>3G (1.600/0.768 Mbps 300ms RTT)</td>
          </tr>

          <tr>
            <td>Viewport</td>
            <td>1200 x 1920px</td>
            <td>512 x 360px</td>
          </tr>
        </tbody>
      </table>
      </div></div>

      <p>
        Desktop websites are run from within a desktop Chrome environment on a Linux VM. The network speed is equivalent to a cable connection.
      </p>

      <p>
        Mobile websites are run from within a mobile Chrome environment on an emulated Moto G4 device with a network speed equivalent to a 3G connection. Note that the emulated mobile User Agent self-identifies as Chrome 65 but is actually Chrome 75 under the hood.
      </p>

      <p>
        There are two locations from which tests are run: California and Oregon USA. HTTP Archive maintains its own test agent hardware located in the <a href="https://archive.org">Internet Archive</a> datacenter in California. Additional test agents in <a href="https://cloud.google.com/compute/docs/regions-zones/#locations">Google Cloud Platform</a>'s us-west-1 location in Oregon are added as needed.
      </p>

      <p>
        HTTP Archive's private instance of WebPageTest is kept in sync with the latest public version and augmented with <a href="https://github.com/HTTPArchive/legacy.httparchive.org/tree/master/custom_metrics">custom metrics</a>. These are snippets of JavaScript that are evaluated on each website at the end of the test. The <a href="https://github.com/HTTPArchive/legacy.httparchive.org/blob/master/custom_metrics/almanac.js">almanac.js</a> custom metric includes several metrics that were otherwise infeasible to calculate, for example those that depend on  DOM state.
      </p>

      <p>
        The results of each test are made available as a <a href="https://en.wikipedia.org/wiki/HAR_(file_format)">HAR file</a>, a JSON-formatted archive file containing metadata about the web page.
      </p>
    </section>

    <section>
      <h3 id="lighthouse"><a href="#lighthouse" class="anchor-link">Lighthouse</a></h3>

      <p>
        <a href="https://developers.google.com/web/tools/lighthouse/">Lighthouse</a> is an automated website quality assurance tool built by Google. It audits web pages to make sure they don't include user experience antipatterns like unoptimized images and inaccessible content.
      </p>

      <p>
        HTTP Archive runs the latest version of Lighthouse for all of its mobile web pages — desktop pages are not included because of limited resources. As of the July 2019 crawl, HTTP Archive used the <a href="https://github.com/GoogleChrome/lighthouse/releases/tag/v5.1.0">5.1.0</a> version of Lighthouse.
      </p>

      <p>
        Lighthouse is run as its own distinct test from within <a href="#webpagetest">WebPageTest</a>, but it has its own configuration profile:
      </p>
      <div class="table-wrap"><div class="table-wrap-container">
      <table>
        <thead>
          <tr>
            <th>Config</th>
            <th>Value</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>CPU slowdown</td>
            <td>1x*</td>
          </tr>
          <tr>
            <td>Download throughput</td>
            <td>1.475 Mbps</td>
          </tr>
          <tr>
            <td>Upload throughput</td>
            <td>0.675 Mbps</td>
          </tr>
          <tr>
            <td>RTT</td>
            <td>150 ms</td>
          </tr>
        </tbody>
      </table>
      </div></div>

      <p class="note">
        * Note that Lighthouse is normally configured to have a CPU slowdown of 4x, but due to a <a href="https://github.com/GoogleChrome/lighthouse/issues/9668#issuecomment-535134232">bug</a> in WebPageTest, this was 1x at the time of the tests.
      </p>

      <p>
        For more information about Lighthouse and the audits available in HTTP Archive, refer to the <a href="https://developers.google.com/web/tools/lighthouse/">Lighthouse developer documentation</a>.
      </p>
    </section>

    <section>
      <h3 id="wappalyzer"><a href="#wappalyzer" class="anchor-link">Wappalyzer</a></h3>

      <p>
        <a href="https://www.wappalyzer.com/">Wappalyzer</a> is a tool for detecting technologies used by web pages. There are <a href="https://www.wappalyzer.com/technologies">65 categories</a> of technologies tested, ranging from JavaScript frameworks, to CMS platforms, and even cryptocurrency miners. There are over 1,200 supported technologies.
      </p>

      <p>
        HTTP Archive runs the latest version of Wappalyzer for all web pages. As of July 2019 the Web Almanac used the <a href="https://github.com/AliasIO/Wappalyzer/releases/tag/v5.8.3">5.8.3 version</a> of Wappalyzer.
      </p>

      <p>
        Wappalyzer powers many chapters that analyze the popularity of developer tools like WordPress, Bootstrap, and jQuery. For example, the <a href="{{ url_for('chapter', year=year, lang=lang, chapter='ecommerce') }}">Ecommerce</a> and <a href="{{ url_for('chapter', year=year, lang=lang, chapter='cms') }}">CMS</a> chapters rely heavily on the respective <a href="https://www.wappalyzer.com/categories/ecommerce">Ecommerce</a> and <a href="https://www.wappalyzer.com/categories/cms">CMS</a> categories of technologies detected by Wappalyzer.
      </p>

      <p>
        All detection tools, including Wappalyzer, have their limitations. The validity of their results will always depend on how accurate their detection mechanisms are. The Web Almanac will add a note in every chapter where Wappalyzer is used but its analysis may not be accurate due to a specific reason.
      </p>
    </section>

    <section>
      <h3 id="chrome-ux-report"><a href="#chrome-ux-report" class="anchor-link">Chrome UX Report</a></h3>

      <p>
        The <a href="https://developers.google.com/web/tools/chrome-user-experience-report">Chrome UX Report</a> is a public dataset of real-world Chrome user experiences. Experiences are grouped by websites' origin, for example <code>https://www.example.com</code>. The dataset includes distributions of UX metrics like paint, load, interaction, and layout stability. In addition to grouping by month, experiences may also be sliced by dimensions like country-level geography, form factor (desktop, phone, tablet), and effective connection type (4G, 3G, etc.).
      </p>

      <p>
        For Web Almanac metrics that reference real-world user experience data from the Chrome UX Report, the July 2019 dataset (201907) is used.
      </p>

      <p>
        You can learn more about the dataset in the <a href="https://web.dev/chrome-ux-report-bigquery">Using the Chrome UX Report on BigQuery</a> guide on <a href="https://web.dev/">web.dev</a>.
      </p>
    </section>

    <section>
      <h3 id="third-party-web"><a href="#third-party-web">Third Party Web</a></h3>

      <p>
        <a href="https://www.thirdpartyweb.today/">Third Party Web</a> is a research project by <a href="{{ url_for('contributors', year=year, lang=lang, _anchor='patrickhulce') }}">Patrick Hulce</a>, author of the <a href="{{ url_for('chapter', year=year, lang=lang, chapter='third-parties') }}">Third Parties</a> chapter, that uses HTTP Archive and Lighthouse data to identify and analyze the impact of third party resources on the web.
      </p>

      <p>
        Domains are considered to be a third party provider if they appear on at least 50 unique pages. The project also groups providers by their respective services in categories like ads, analytics, and social.
      </p>

      <p>
        Several chapters in the Web Almanac use the domains and categories from this dataset to understand the impact of third parties.
      </p>
    </section>

    <section>
      <h3 id="rework-css"><a href="#rework-css" class="anchor-link">Rework CSS</a></h3>

      <p>
        <a href="https://github.com/reworkcss/css">Rework CSS</a> is a JavaScript-based CSS parser. It takes entire stylesheets and produces a JSON-encoded object distinguishing each individual style rule, selector, directive, and value.
      </p>

      <p>
        This special purpose tool significantly improved the accuracy of many of the metrics in the <a href="{{ url_for('chapter', year=year, lang=lang, chapter='css') }}">CSS</a> chapter. CSS in all external stylesheets and inline style blocks for each page were parsed and queried to make the analysis possible. See <a href="https://discuss.httparchive.org/t/analyzing-stylesheets-with-a-js-based-parser/1683">this thread</a> for more information about how it was integrated with the HTTP Archive dataset on BigQuery.
      </p>
    </section>

    <section>
      <h2 id="process"><a href="#process" class="anchor-link">Analytical process</a></h2>

      <p>
        The Web Almanac took about a year to plan and execute with the coordination of dozens of contributors from the web community. This section describes why we chose the metrics you see in the Web Almanac, how they were queried, and interpreted.
      </p>
    </section>

    <section>
      <h3 id="brainstorming"><a href="#brainstorming" class="anchor-link">Brainstorming</a></h3>

      <p>
        The inception of the Web Almanac started in January 2019 as a <a href="https://discuss.httparchive.org/t/planning-the-web-almanac-2019/1553">post on the HTTP Archive forum</a> describing the initiative and gathering support. In March 2019 we created a <a href="http://bit.ly/web-almanac-brainstorm">public brainstorming doc</a> in which anyone in the web community could write-in ideas for chapters or metrics. This was a critical step to ensure we were focusing on things that matter to the community and have a diverse set of voices included in the process.
      </p>

      <p>
        经过头脑风暴, 20个章节被固化确定， 我们开始 <a href="https://github.com/HTTPArchive/almanac.httparchive.org/issues/2">分配主题专家和对应的审稿人</a>。 这个过程有一些固有的偏见，因为要让志愿者致力于这样规模的项目是一个挑战。因此，许多贡献者是同一专业圈子的成员。Web Almanac网络年鉴的未来版本的一个明确目标是鼓励更多未被充分代表和异质的声音作为作者和审稿人。
      </p>

      <p>
        We spent May through June 2019 pairing people with chapters and getting their input to finalize the individual metrics that will make up each chapter.
      </p>
    </section>

    <section>
      <h3 id="analysis"><a href="#analysis" class="anchor-link">Analysis</a></h3>

      <p>
        In June 2019, with the stable list of metrics and chapters, data analysts triaged the metrics for feasibility. In some cases, <a href="https://github.com/HTTPArchive/legacy.httparchive.org/blob/master/custom_metrics/almanac.js">custom metrics</a> needed to be created to fill gaps in our analytic capabilities.
      </p>

      <p>
        整个2019年7月, HTTP Archive 数据管道爬取了数百万网站, 收集到的元数据用于了Web Almanac.
      </p>

      <p>
        Starting in August 2019, the data analysts began writing queries to extract the results for each metric. In total, <strong>431 queries</strong> were written by hand! You can browse all of the queries by chapter in the <a href="https://github.com/HTTPArchive/almanac.httparchive.org/tree/main/sql/2019">sql/2019</a> directory of the project's GitHub repository.
      </p>
    </section>

    <section>
      <h3 id="interpretation"><a href="#interpretation" class="anchor-link">Interpretation</a></h3>

      <p>
        作者与分析人员一起正确地解释结果并得出适当的结论。当作者撰写他们各自的章节时，他们利用这些统计数据得出支持他们的web状态的框架。审稿人与作者一起工作，以确保他们的分析在技术上的正确性。
      </p>

      <p>
        为了让读者更容易理解结果，web开发人员和分析人员创建了数据可视化嵌入到本章中。为了使结论更容易理解，一些可视化方法被简化了。例如，它没有显示一个完整的分布柱状图，而是只显示了少量的百分比。除非另有说明，所有分布都是用百分位数汇总的，特别是中位数(第50的百分位数)，而不是平均值。
      </p>

      <p>
        最后，编辑修改了章节，以纠正简单的语法错误，确保阅读体验的一致性。
      </p>
    </section>

    <section>
      <h2 id="looking-ahead"><a href="#looking-ahead" class="anchor-link">Looking ahead</a></h2>

      <p>
        The 2019 edition of the Web Almanac is the first of what we hope to be an annual tradition in the web community of introspection and a commitment to positive change. Getting to this point has been a monumental effort thanks to many dedicated <a href="{{ url_for('contributors', year=year, lang=lang) }}">contributors</a> and we hope to leverage as much of this work as possible to make future editions even more streamlined.
      </p>

      <p>
        如果您对2020年版的Web Almanac网络年鉴有兴趣, 请填写 <a href="https://forms.gle/Qyf3q5pKgdH1cBhq5">感兴趣表格</a>. 我们非常希望倾听你的想法，让这个项目变得更好!
      </p>
    </section>
{% endblock main_content %}
