const writingScriptDetector = (() => {
  // Taken from the detect-writing-script project.
  // https://github.com/bramstein/detect-writing-script
  // Licensed under the BSD-3-Clause.

  const scripts = {"Adlam":[[125184,125260],[125264,125274],[125278,125280]],"Arabic":[[1536,1541],[1542,1548],[1549,1563],[1564,1567],[1568,1600],[1601,1611],[1622,1648],[1649,1757],[1758,1792],[1872,1920],[2160,2191],[2192,2194],[2200,2274],[2275,2304],[64336,64451],[64467,64830],[64832,64912],[64914,64968],[64975,64976],[65008,65024],[65136,65141],[65142,65277],[69216,69247],[69373,69376],[126464,126468],[126469,126496],[126497,126499],[126500,126501],[126503,126504],[126505,126515],[126516,126520],[126521,126522],[126523,126524],[126530,126531],[126535,126536],[126537,126538],[126539,126540],[126541,126544],[126545,126547],[126548,126549],[126551,126552],[126553,126554],[126555,126556],[126557,126558],[126559,126560],[126561,126563],[126564,126565],[126567,126571],[126572,126579],[126580,126584],[126585,126589],[126590,126591],[126592,126602],[126603,126620],[126625,126628],[126629,126634],[126635,126652],[126704,126706]],"Armenian":[[1329,1367],[1369,1419],[1421,1424],[64275,64280]],"Balinese":[[6912,6989],[6992,7039]],"Bamum":[[42656,42744],[92160,92729]],"Batak":[[7104,7156],[7164,7168]],"Bengali":[[2432,2436],[2437,2445],[2447,2449],[2451,2473],[2474,2481],[2482,2483],[2486,2490],[2492,2501],[2503,2505],[2507,2511],[2519,2520],[2524,2526],[2527,2532],[2534,2559]],"Bopomofo":[[746,748],[12549,12592],[12704,12736]],"Braille":[[10240,10496]],"Buginese":[[6656,6684],[6686,6688]],"Buhid":[[5952,5972]],"Canadian_Aboriginal":[[5120,5760],[6320,6390],[72368,72384]],"Chakma":[[69888,69941],[69942,69960]],"Cham":[[43520,43575],[43584,43598],[43600,43610],[43612,43616]],"Cherokee":[[5024,5110],[5112,5118],[43888,43968]],"Cyrillic":[[1024,1157],[1159,1328],[7296,7305],[7467,7468],[7544,7545],[11744,11776],[42560,42656],[65070,65072],[122928,122990],[123023,123024]],"Deseret":[[66560,66640]],"Devanagari":[[2304,2385],[2389,2404],[2406,2432],[43232,43264],[72448,72458]],"Duployan":[[113664,113771],[113776,113789],[113792,113801],[113808,113818],[113820,113824]],"Ethiopic":[[4608,4681],[4682,4686],[4688,4695],[4696,4697],[4698,4702],[4704,4745],[4746,4750],[4752,4785],[4786,4790],[4792,4799],[4800,4801],[4802,4806],[4808,4823],[4824,4881],[4882,4886],[4888,4955],[4957,4989],[4992,5018],[11648,11671],[11680,11687],[11688,11695],[11696,11703],[11704,11711],[11712,11719],[11720,11727],[11728,11735],[11736,11743],[43777,43783],[43785,43791],[43793,43799],[43808,43815],[43816,43823],[124896,124903],[124904,124908],[124909,124911],[124912,124927]],"Georgian":[[4256,4294],[4295,4296],[4301,4302],[4304,4347],[4348,4352],[7312,7355],[7357,7360],[11520,11558],[11559,11560],[11565,11566]],"Greek":[[880,884],[885,888],[890,894],[895,896],[900,901],[902,903],[904,907],[908,909],[910,930],[931,994],[1008,1024],[7462,7467],[7517,7522],[7526,7531],[7615,7616],[7936,7958],[7960,7966],[7968,8006],[8008,8014],[8016,8024],[8025,8026],[8027,8028],[8029,8030],[8031,8062],[8064,8117],[8118,8133],[8134,8148],[8150,8156],[8157,8176],[8178,8181],[8182,8191],[8486,8487],[43877,43878],[65856,65935],[65952,65953],[119296,119366]],"Gujarati":[[2689,2692],[2693,2702],[2703,2706],[2707,2729],[2730,2737],[2738,2740],[2741,2746],[2748,2758],[2759,2762],[2763,2766],[2768,2769],[2784,2788],[2790,2802],[2809,2816]],"Gunjala_Gondi":[[73056,73062],[73063,73065],[73066,73103],[73104,73106],[73107,73113],[73120,73130]],"Gurmukhi":[[2561,2564],[2565,2571],[2575,2577],[2579,2601],[2602,2609],[2610,2612],[2613,2615],[2616,2618],[2620,2621],[2622,2627],[2631,2633],[2635,2638],[2641,2642],[2649,2653],[2654,2655],[2662,2679]],"Han":[[11904,11930],[11931,12020],[12032,12246],[12293,12294],[12295,12296],[12321,12330],[12344,12348],[13312,19904],[19968,40960],[63744,64110],[64112,64218],[94178,94180],[94192,94194],[131072,173792],[173824,177978],[177984,178206],[178208,183970],[183984,191457],[194560,195102],[196608,201547],[201552,205744]],"Hangul":[[4352,4608],[12334,12336],[12593,12687],[12800,12831],[12896,12927],[43360,43389],[44032,55204],[55216,55239],[55243,55292],[65440,65471],[65474,65480],[65482,65488],[65490,65496],[65498,65501]],"Hanifi_Rohingya":[[68864,68904],[68912,68922]],"Hanunoo":[[5920,5941]],"Hebrew":[[1425,1480],[1488,1515],[1519,1525],[64285,64311],[64312,64317],[64318,64319],[64320,64322],[64323,64325],[64326,64336]],"Hiragana":[[12353,12439],[12445,12448],[110593,110880],[110898,110899],[110928,110931],[127488,127489]],"Inherited":[[768,880],[1157,1159],[1611,1622],[1648,1649],[2385,2389],[6832,6863],[7376,7379],[7380,7393],[7394,7401],[7405,7406],[7412,7413],[7416,7418],[7616,7680],[8204,8206],[8400,8433],[12330,12334],[12441,12443],[65024,65040],[65056,65070],[66045,66046],[66272,66273],[70459,70460],[118528,118574],[118576,118599],[119143,119146],[119163,119171],[119173,119180],[119210,119214],[917760,918000]],"Inscriptional_Pahlavi":[[68448,68467],[68472,68480]],"Javanese":[[43392,43470],[43472,43482],[43486,43488]],"Kannada":[[3200,3213],[3214,3217],[3218,3241],[3242,3252],[3253,3258],[3260,3269],[3270,3273],[3274,3278],[3285,3287],[3293,3295],[3296,3300],[3302,3312],[3313,3316]],"Katakana":[[12449,12539],[12541,12544],[12784,12800],[13008,13055],[13056,13144],[65382,65392],[65393,65438],[110576,110580],[110581,110588],[110589,110591],[110592,110593],[110880,110883],[110933,110934],[110948,110952]],"Kawi":[[73472,73489],[73490,73531],[73534,73562]],"Kayah_Li":[[43264,43310],[43311,43312]],"Khmer":[[6016,6110],[6112,6122],[6128,6138],[6624,6656]],"Khudawadi":[[70320,70379],[70384,70394]],"Lao":[[3713,3715],[3716,3717],[3718,3723],[3724,3748],[3749,3750],[3751,3774],[3776,3781],[3782,3783],[3784,3791],[3792,3802],[3804,3808]],"Latin":[[65,91],[97,123],[170,171],[186,187],[192,215],[216,247],[248,697],[736,741],[7424,7462],[7468,7517],[7522,7526],[7531,7544],[7545,7615],[7680,7936],[8305,8306],[8319,8320],[8336,8349],[8490,8492],[8498,8499],[8526,8527],[8544,8585],[11360,11392],[42786,42888],[42891,42955],[42960,42962],[42963,42964],[42965,42970],[42994,43008],[43824,43867],[43868,43877],[43878,43882],[64256,64263],[65313,65339],[65345,65371],[67456,67462],[67463,67505],[67506,67515],[122624,122655],[122661,122667]],"Lepcha":[[7168,7224],[7227,7242],[7245,7248]],"Limbu":[[6400,6431],[6432,6444],[6448,6460],[6464,6465],[6468,6480]],"Lisu":[[42192,42240],[73648,73649]],"Malayalam":[[3328,3341],[3342,3345],[3346,3397],[3398,3401],[3402,3408],[3412,3428],[3430,3456]],"Mandaic":[[2112,2140],[2142,2143]],"Masaram_Gondi":[[72960,72967],[72968,72970],[72971,73015],[73018,73019],[73020,73022],[73023,73032],[73040,73050]],"Medefaidrin":[[93760,93851]],"Meetei_Mayek":[[43744,43767],[43968,44014],[44016,44026]],"Mende_Kikakui":[[124928,125125],[125127,125143]],"Miao":[[93952,94027],[94031,94088],[94095,94112]],"Mongolian":[[6144,6146],[6148,6149],[6150,6170],[6176,6265],[6272,6315],[71264,71277]],"Mro":[[92736,92767],[92768,92778],[92782,92784]],"Myanmar":[[4096,4256],[43488,43519],[43616,43648]],"Nag_Mundari":[[124112,124154]],"New_Tai_Lue":[[6528,6572],[6576,6602],[6608,6619],[6622,6624]],"Newa":[[70656,70748],[70749,70754]],"Nko":[[1984,2043],[2045,2048]],"Nushu":[[94177,94178],[110960,111356]],"Nyiakeng_Puachue_Hmong":[[123136,123181],[123184,123198],[123200,123210],[123214,123216]],"Ol_Chiki":[[7248,7296]],"Oriya":[[2817,2820],[2821,2829],[2831,2833],[2835,2857],[2858,2865],[2866,2868],[2869,2874],[2876,2885],[2887,2889],[2891,2894],[2901,2904],[2908,2910],[2911,2916],[2918,2936]],"Osage":[[66736,66772],[66776,66812]],"Osmanya":[[66688,66718],[66720,66730]],"Pahawh_Hmong":[[92928,92998],[93008,93018],[93019,93026],[93027,93048],[93053,93072]],"Pau_Cin_Hau":[[72384,72441]],"Rejang":[[43312,43348],[43359,43360]],"Samaritan":[[2048,2094],[2096,2111]],"Saurashtra":[[43136,43206],[43214,43226]],"Sharada":[[70016,70112]],"Shavian":[[66640,66688]],"SignWriting":[[120832,121484],[121499,121504],[121505,121520]],"Sinhala":[[3457,3460],[3461,3479],[3482,3506],[3507,3516],[3517,3518],[3520,3527],[3530,3531],[3535,3541],[3542,3543],[3544,3552],[3558,3568],[3570,3573],[70113,70133]],"Sora_Sompeng":[[69840,69865],[69872,69882]],"Sundanese":[[7040,7104],[7360,7368]],"Syriac":[[1792,1806],[1807,1867],[1869,1872],[2144,2155]],"Tagalog":[[5888,5910],[5919,5920]],"Tagbanwa":[[5984,5997],[5998,6001],[6002,6004]],"Tai_Le":[[6480,6510],[6512,6517]],"Tai_Tham":[[6688,6751],[6752,6781],[6783,6794],[6800,6810],[6816,6830]],"Tai_Viet":[[43648,43715],[43739,43744]],"Takri":[[71296,71354],[71360,71370]],"Tamil":[[2946,2948],[2949,2955],[2958,2961],[2962,2966],[2969,2971],[2972,2973],[2974,2976],[2979,2981],[2984,2987],[2990,3002],[3006,3011],[3014,3017],[3018,3022],[3024,3025],[3031,3032],[3046,3067],[73664,73714],[73727,73728]],"Tangsa":[[92784,92863],[92864,92874]],"Telugu":[[3072,3085],[3086,3089],[3090,3113],[3114,3130],[3132,3141],[3142,3145],[3146,3150],[3157,3159],[3160,3163],[3165,3166],[3168,3172],[3174,3184],[3191,3200]],"Thaana":[[1920,1970]],"Thai":[[3585,3643],[3648,3676]],"Tibetan":[[3840,3912],[3913,3949],[3953,3992],[3993,4029],[4030,4045],[4046,4053],[4057,4059]],"Tifinagh":[[11568,11624],[11631,11633],[11647,11648]],"Tirhuta":[[70784,70856],[70864,70874]],"Toto":[[123536,123567]],"Vai":[[42240,42540]],"Wancho":[[123584,123642],[123647,123648]],"Warang_Citi":[[71840,71923],[71935,71936]],"Yi":[[40960,42125],[42128,42183]],"Emoji":[[35,36],[42,43],[48,58],[169,170],[174,175],[8252,8253],[8265,8266],[8482,8483],[8505,8506],[8596,8602],[8617,8619],[8986,8988],[9000,9001],[9167,9168],[9193,9204],[9208,9211],[9410,9411],[9642,9644],[9654,9655],[9664,9665],[9723,9727],[9728,9733],[9742,9743],[9745,9746],[9748,9750],[9752,9753],[9757,9758],[9760,9761],[9762,9764],[9766,9767],[9770,9771],[9774,9776],[9784,9787],[9792,9793],[9794,9795],[9800,9812],[9823,9825],[9827,9828],[9829,9831],[9832,9833],[9851,9852],[9854,9856],[9874,9880],[9881,9882],[9883,9885],[9888,9890],[9895,9896],[9898,9900],[9904,9906],[9917,9919],[9924,9926],[9928,9929],[9934,9936],[9937,9938],[9939,9941],[9961,9963],[9968,9974],[9975,9979],[9981,9982],[9986,9987],[9989,9990],[9992,9998],[9999,10000],[10002,10003],[10004,10005],[10006,10007],[10013,10014],[10017,10018],[10024,10025],[10035,10037],[10052,10053],[10055,10056],[10060,10061],[10062,10063],[10067,10070],[10071,10072],[10083,10085],[10133,10136],[10145,10146],[10160,10161],[10175,10176],[10548,10550],[11013,11016],[11035,11037],[11088,11089],[11093,11094],[12336,12337],[12349,12350],[12951,12952],[12953,12954],[126980,126981],[127183,127184],[127344,127346],[127358,127360],[127374,127375],[127377,127387],[127462,127488],[127489,127491],[127514,127515],[127535,127536],[127538,127547],[127568,127570],[127744,127778],[127780,127892],[127894,127896],[127897,127900],[127902,127985],[127987,127990],[127991,128254],[128255,128318],[128329,128335],[128336,128360],[128367,128369],[128371,128379],[128391,128392],[128394,128398],[128400,128401],[128405,128407],[128420,128422],[128424,128425],[128433,128435],[128444,128445],[128450,128453],[128465,128468],[128476,128479],[128481,128482],[128483,128484],[128488,128489],[128495,128496],[128499,128500],[128506,128592],[128640,128710],[128715,128723],[128725,128728],[128732,128742],[128745,128746],[128747,128749],[128752,128753],[128755,128765],[128992,129004],[129008,129009],[129292,129339],[129340,129350],[129351,129536],[129648,129661],[129664,129673],[129680,129726],[129727,129734],[129742,129756],[129760,129769],[129776,129785]],"Emoji_Modifier":[[127995,128000]],"Emoji_Modifier_Base":[[9757,9758],[9977,9978],[9994,9998],[127877,127878],[127938,127941],[127943,127944],[127946,127949],[128066,128068],[128070,128081],[128102,128121],[128124,128125],[128129,128132],[128133,128136],[128143,128144],[128145,128146],[128170,128171],[128372,128374],[128378,128379],[128400,128401],[128405,128407],[128581,128584],[128587,128592],[128675,128676],[128692,128695],[128704,128705],[128716,128717],[129292,129293],[129295,129296],[129304,129312],[129318,129319],[129328,129338],[129340,129343],[129399,129400],[129461,129463],[129464,129466],[129467,129468],[129485,129488],[129489,129502],[129731,129734],[129776,129785]],"Emoji_Presentation":[[8986,8988],[9193,9197],[9200,9201],[9203,9204],[9725,9727],[9748,9750],[9800,9812],[9855,9856],[9875,9876],[9889,9890],[9898,9900],[9917,9919],[9924,9926],[9934,9935],[9940,9941],[9962,9963],[9970,9972],[9973,9974],[9978,9979],[9981,9982],[9989,9990],[9994,9996],[10024,10025],[10060,10061],[10062,10063],[10067,10070],[10071,10072],[10133,10136],[10160,10161],[10175,10176],[11035,11037],[11088,11089],[11093,11094],[126980,126981],[127183,127184],[127374,127375],[127377,127387],[127462,127488],[127489,127490],[127514,127515],[127535,127536],[127538,127543],[127544,127547],[127568,127570],[127744,127777],[127789,127798],[127799,127869],[127870,127892],[127904,127947],[127951,127956],[127968,127985],[127988,127989],[127992,128063],[128064,128065],[128066,128253],[128255,128318],[128331,128335],[128336,128360],[128378,128379],[128405,128407],[128420,128421],[128507,128592],[128640,128710],[128716,128717],[128720,128723],[128725,128728],[128732,128736],[128747,128749],[128756,128765],[128992,129004],[129008,129009],[129292,129339],[129340,129350],[129351,129536],[129648,129661],[129664,129673],[129680,129726],[129727,129734],[129742,129756],[129760,129769],[129776,129785]],"PUA":[[57344,63743],[983040,1048573],[1048576,1114109]]}

  // To make this code as fast as possible we create some
  // auxillary data structures.
  const names = Object.keys(scripts);
  const ranges = Object.values(scripts);
  const totals = new Array(names.length).fill(0);
  const counts = new Array(names.length);

  // Calculate the total number of codepoints for each script. We
  // can easily do this by summing the number of codepoints in
  // each range and script.
  for (let i = 0; i < ranges.length; i++) {
    for (let j = 0; j < ranges[i].length; j++) {
      totals[i] += ranges[i][j][1] - ranges[i][j][0];
    }
  }

  /**
   * @param {Array.<Number>} codepoints
   * @param {Number} threshold
   **/
  function detect(codepoints, threshold) {
    // Reset the counts array
    counts.fill(0);

    for (let j = 0; j < codepoints.length; j++) {
      all:
      for (let i = 0; i < ranges.length; i++) {
        for (let k = 0; k < ranges[i].length; k++) {
          // Exit the outer loop (script) if the codepoint has been found.
          // The ranges don't repeat so we won't find the codepoint again.
          if (codepoints[j] >= ranges[i][k][0] && codepoints[j] <= ranges[i][k][1]) {
            counts[i]++;
            break all; // NOTE: This uses a label to jump out of both loops at once.
          }

          // Also exit the inner loop (ranges) early if the codepoint is smaller,
          // as we won't find the codepoint in subsequent ranges.
          if (ranges[i][k][0] > codepoints[j]) {
            break;
          }
        }
      }
    }

    const result = [];

    for (let i = 0; i < names.length; i++) {
      if (counts[i] / totals[i] > threshold || (names[i] === 'PUA' && counts[i] > 0)) {
        result.push(names[i]);
      }
    }

    return result;
  }

  return detect;
})();

function detectWritingScript(codepoints, threshold) {
  return writingScriptDetector(codepoints, threshold);
}
